const isNode=e=>e instanceof HTMLElement,createStore=(e,t=[],r=[])=>{const o={...e},i=[],n=[],s=(e,t,r)=>{!r||document.hidden?(d[e]&&d[e](t),i.push({type:e,data:t})):n.push({type:e,data:t})},a=(e,...t)=>c[e]?c[e](...t):null,l={getState:()=>({...o}),processActionQueue:()=>{const e=[...i];return i.length=0,e},processDispatchQueue:()=>{const e=[...n];n.length=0,e.forEach((({type:e,data:t})=>{s(e,t)}))},dispatch:s,query:a};let c={};t.forEach((e=>{c={...e(o),...c}}));let d={};return r.forEach((e=>{d={...e(s,a,o),...d}})),l},defineProperty=(e,t,r)=>{"function"!=typeof r?Object.defineProperty(e,t,{...r}):e[t]=r},forin=(e,t)=>{for(const r in e)e.hasOwnProperty(r)&&t(r,e[r])},createObject=e=>{const t={};return forin(e,(r=>{defineProperty(t,r,e[r])})),t},attr=(e,t,r=null)=>{if(null===r)return e.getAttribute(t)||e.hasAttribute(t);e.setAttribute(t,r)},ns="http://www.w3.org/2000/svg",svgElements=["svg","path"],isSVGElement=e=>svgElements.includes(e),createElement=(e,t,r={})=>{"object"==typeof t&&(r=t,t=null);const o=isSVGElement(e)?document.createElementNS(ns,e):document.createElement(e);return t&&(isSVGElement(e)?attr(o,"class",t):o.className=t),forin(r,((e,t)=>{attr(o,e,t)})),o},appendChild=e=>(t,r)=>{void 0!==r&&e.children[r]?e.insertBefore(t,e.children[r]):e.appendChild(t)},appendChildView=(e,t)=>(e,r)=>(void 0!==r?t.splice(r,0,e):t.push(e),e),removeChildView=(e,t)=>r=>(t.splice(t.indexOf(r),1),r.element.parentNode&&e.removeChild(r.element),r),IS_BROWSER="undefined"!=typeof window&&void 0!==window.document,isBrowser=()=>IS_BROWSER,testElement=isBrowser()?createElement("svg"):{},getChildCount="children"in testElement?e=>e.children.length:e=>e.childNodes.length,getViewRect=(e,t,r,o)=>{const i=r[0]||e.left,n=r[1]||e.top,s=i+e.width,a=n+e.height*(o[1]||1),l={element:{...e},inner:{left:e.left,top:e.top,right:e.right,bottom:e.bottom},outer:{left:i,top:n,right:s,bottom:a}};return t.filter((e=>!e.isRectIgnored())).map((e=>e.rect)).forEach((e=>{expandRect(l.inner,{...e.inner}),expandRect(l.outer,{...e.outer})})),calculateRectSize(l.inner),l.outer.bottom+=l.element.marginBottom,l.outer.right+=l.element.marginRight,calculateRectSize(l.outer),l},expandRect=(e,t)=>{t.top+=e.top,t.right+=e.left,t.bottom+=e.top,t.left+=e.left,t.bottom>e.bottom&&(e.bottom=t.bottom),t.right>e.right&&(e.right=t.right)},calculateRectSize=e=>{e.width=e.right-e.left,e.height=e.bottom-e.top},isNumber=e=>"number"==typeof e,thereYet=(e,t,r,o=.001)=>Math.abs(e-t)<o&&Math.abs(r)<o,spring=({stiffness:e=.5,damping:t=.75,mass:r=10}={})=>{let o=null,i=null,n=0,s=!1;const a=createObject({interpolate:(l,c)=>{if(s)return;if(!isNumber(o)||!isNumber(i))return s=!0,void(n=0);n+=-(i-o)*e/r,i+=n,n*=t,thereYet(i,o,n)||c?(i=o,n=0,s=!0,a.onupdate(i),a.oncomplete(i)):a.onupdate(i)},target:{set:e=>{if(isNumber(e)&&!isNumber(i)&&(i=e),null===o&&(o=e,i=e),o=e,i===o||void 0===o)return s=!0,n=0,a.onupdate(i),void a.oncomplete(i);s=!1},get:()=>o},resting:{get:()=>s},onupdate:e=>{},oncomplete:e=>{}});return a},easeLinear=e=>e,easeInOutQuad=e=>e<.5?2*e*e:(4-2*e)*e-1,tween=({duration:e=500,easing:t=easeInOutQuad,delay:r=0}={})=>{let o,i,n=null,s=!0,a=!1,l=null;const c=createObject({interpolate:(d,p)=>{s||null===l||(null===n&&(n=d),d-n<r||(o=d-n-r,o>=e||p?(o=1,i=a?0:1,c.onupdate(i*l),c.oncomplete(i*l),s=!0):(i=o/e,c.onupdate((o>=0?t(a?1-i:i):0)*l))))},target:{get:()=>a?0:l,set:e=>{if(null===l)return l=e,c.onupdate(e),void c.oncomplete(e);e<l?(l=1,a=!0):(a=!1,l=e),s=!1,n=null}},resting:{get:()=>s},onupdate:e=>{},oncomplete:e=>{}});return c},animator={spring:spring,tween:tween},createAnimator=(e,t,r)=>{const o=e[t]&&"object"==typeof e[t][r]?e[t][r]:e[t]||e,i="string"==typeof o?o:o.type,n="object"==typeof o?{...o}:{};return animator[i]?animator[i](n):null},addGetSet=(e,t,r,o=!1)=>{(t=Array.isArray(t)?t:[t]).forEach((t=>{e.forEach((e=>{let i=e,n=()=>r[e],s=t=>r[e]=t;"object"==typeof e&&(i=e.key,n=e.getter||n,s=e.setter||s),t[i]&&!o||(t[i]={get:n,set:s})}))}))},animations=({mixinConfig:e,viewProps:t,viewInternalAPI:r,viewExternalAPI:o})=>{const i={...t},n=[];return forin(e,((e,s)=>{const a=createAnimator(s);if(!a)return;a.onupdate=r=>{t[e]=r},a.target=i[e];addGetSet([{key:e,setter:e=>{a.target!==e&&(a.target=e)},getter:()=>t[e]}],[r,o],t,!0),n.push(a)})),{write:e=>{let t=document.hidden,r=!0;return n.forEach((o=>{o.resting||(r=!1),o.interpolate(e,t)})),r},destroy:()=>{}}},addEvent=e=>(t,r)=>{e.addEventListener(t,r)},removeEvent=e=>(t,r)=>{e.removeEventListener(t,r)},listeners=({mixinConfig:e,viewProps:t,viewInternalAPI:r,viewExternalAPI:o,viewState:i,view:n})=>{const s=[],a=(l=n.element,(e,t)=>{l.addEventListener(e,t)});var l;const c=removeEvent(n.element);return o.on=(e,t)=>{s.push({type:e,fn:t}),a(e,t)},o.off=(e,t)=>{s.splice(s.findIndex((r=>r.type===e&&r.fn===t)),1),c(e,t)},{write:()=>!0,destroy:()=>{s.forEach((e=>{c(e.type,e.fn)}))}}},apis=({mixinConfig:e,viewProps:t,viewExternalAPI:r})=>{addGetSet(e,r,t)},isDefined=e=>null!=e,defaults={opacity:1,scaleX:1,scaleY:1,translateX:0,translateY:0,rotateX:0,rotateY:0,rotateZ:0,originX:0,originY:0},styles=({mixinConfig:e,viewProps:t,viewInternalAPI:r,viewExternalAPI:o,view:i})=>{const n={...t},s={};addGetSet(e,[r,o],t);const a=()=>i.rect?getViewRect(i.rect,i.childViews,[t.translateX||0,t.translateY||0],[t.scaleX||0,t.scaleY||0]):null;return r.rect={get:a},o.rect={get:a},e.forEach((e=>{t[e]=void 0===n[e]?defaults[e]:n[e]})),{write:()=>{if(propsHaveChanged(s,t))return applyStyles(i.element,t),Object.assign(s,{...t}),!0},destroy:()=>{}}},propsHaveChanged=(e,t)=>{if(Object.keys(e).length!==Object.keys(t).length)return!0;for(const r in t)if(t[r]!==e[r])return!0;return!1},applyStyles=(e,{opacity:t,perspective:r,translateX:o,translateY:i,scaleX:n,scaleY:s,rotateX:a,rotateY:l,rotateZ:c,originX:d,originY:p,width:u,height:E})=>{let m="",I="";(isDefined(d)||isDefined(p))&&(I+=`transform-origin: ${d||0}px ${p||0}px;`),isDefined(r)&&(m+=`perspective(${r}px) `),(isDefined(o)||isDefined(i))&&(m+=`translate3d(${o||0}px, ${i||0}px, 0) `),(isDefined(n)||isDefined(s))&&(m+=`scale3d(${isDefined(n)?n:1}, ${isDefined(s)?s:1}, 1) `),isDefined(c)&&(m+=`rotateZ(${c}rad) `),isDefined(a)&&(m+=`rotateX(${a}rad) `),isDefined(l)&&(m+=`rotateY(${l}rad) `),m.length&&(I+=`transform:${m};`),isDefined(t)&&(I+=`opacity:${t};`,0===t&&(I+="visibility:hidden;"),t<1&&(I+="pointer-events:none;")),isDefined(E)&&(I+=`height:${E}px;`),isDefined(u)&&(I+=`width:${u}px;`);const T=e.elementCurrentStyle||"";I.length===T.length&&I===T||(e.style.cssText=I,e.elementCurrentStyle=I)},Mixins={styles:styles,listeners:listeners,animations:animations,apis:apis},updateRect=(e={},t={},r={})=>(t.layoutCalculated||(e.paddingTop=parseInt(r.paddingTop,10)||0,e.marginTop=parseInt(r.marginTop,10)||0,e.marginRight=parseInt(r.marginRight,10)||0,e.marginBottom=parseInt(r.marginBottom,10)||0,e.marginLeft=parseInt(r.marginLeft,10)||0,t.layoutCalculated=!0),e.left=t.offsetLeft||0,e.top=t.offsetTop||0,e.width=t.offsetWidth||0,e.height=t.offsetHeight||0,e.right=e.left+e.width,e.bottom=e.top+e.height,e.scrollTop=t.scrollTop,e.hidden=null===t.offsetParent,e),createView=({tag:e="div",name:t=null,attributes:r={},read:o=(()=>{}),write:i=(()=>{}),create:n=(()=>{}),destroy:s=(()=>{}),filterFrameActionsForChild:a=((e,t)=>t),didCreateView:l=(()=>{}),didWriteView:c=(()=>{}),ignoreRect:d=!1,ignoreRectUpdate:p=!1,mixins:u=[]}={})=>(E,m={})=>{const I=createElement(e,`filepond--${t}`,r),T=window.getComputedStyle(I,null),f=updateRect();let g=null,_=!1;const R=[],h=[],y={},O={},S=[i],D=[o],A=[s],P=()=>I,b=()=>R.concat(),L=()=>g||(g=getViewRect(f,R,[0,0],[1,1]),g),v={element:{get:P},style:{get:()=>T},childViews:{get:b}},M={...v,rect:{get:L},ref:{get:()=>y},is:e=>t===e,appendChild:(C=I,(e,t)=>{void 0!==t&&C.children[t]?C.insertBefore(e,C.children[t]):C.appendChild(e)}),createChildView:(e=>(t,r)=>t(e,r))(E),linkView:e=>(R.push(e),e),unlinkView:e=>{R.splice(R.indexOf(e),1)},appendChildView:appendChildView(0,R),removeChildView:removeChildView(I,R),registerWriter:e=>S.push(e),registerReader:e=>D.push(e),registerDestroyer:e=>A.push(e),invalidateLayout:()=>I.layoutCalculated=!1,dispatch:E.dispatch,query:E.query};var C;const w={element:{get:P},childViews:{get:b},rect:{get:L},resting:{get:()=>_},isRectIgnored:()=>d,_read:()=>{g=null,R.forEach((e=>e._read()));!(p&&f.width&&f.height)&&updateRect(f,I,T);const e={root:F,props:m,rect:f};D.forEach((t=>t(e)))},_write:(e,t,r)=>{let o=0===t.length;return S.forEach((i=>{!1===i({props:m,root:F,actions:t,timestamp:e,shouldOptimize:r})&&(o=!1)})),h.forEach((t=>{!1===t.write(e)&&(o=!1)})),R.filter((e=>!!e.element.parentNode)).forEach((i=>{i._write(e,a(i,t),r)||(o=!1)})),R.forEach(((i,n)=>{i.element.parentNode||(F.appendChild(i.element,n),i._read(),i._write(e,a(i,t),r),o=!1)})),_=o,c({props:m,root:F,actions:t,timestamp:e}),o},_destroy:()=>{h.forEach((e=>e.destroy())),A.forEach((e=>{e({root:F,props:m})})),R.forEach((e=>e._destroy()))}},N={...v,rect:{get:()=>f}};Object.keys(u).sort(((e,t)=>"styles"===e?1:"styles"===t?-1:0)).forEach((e=>{const t=Mixins[e]({mixinConfig:u[e],viewProps:m,viewState:O,viewInternalAPI:M,viewExternalAPI:w,view:createObject(N)});t&&h.push(t)}));const F=createObject(M);n({root:F,props:m});const G=getChildCount(I);return R.forEach(((e,t)=>{F.appendChild(e.element,G+t)})),l(F),createObject(w)},createPainter=(e,t,r=60)=>{const o="__framePainter";if(window[o])return window[o].readers.push(e),void window[o].writers.push(t);window[o]={readers:[e],writers:[t]};const i=window[o],n=1e3/r;let s=null,a=null,l=null,c=null;const d=()=>{document.hidden?(l=()=>window.setTimeout((()=>p(performance.now())),n),c=()=>window.clearTimeout(a)):(l=()=>window.requestAnimationFrame(p),c=()=>window.cancelAnimationFrame(a))};document.addEventListener("visibilitychange",(()=>{c&&c(),d(),p(performance.now())}));const p=e=>{a=l(p),s||(s=e);const t=e-s;t<=n||(s=e-t%n,i.readers.forEach((e=>e())),i.writers.forEach((t=>t(e))))};return d(),p(performance.now()),{pause:()=>{c(a)}}},createRoute=(e,t)=>({root:r,props:o,actions:i=[],timestamp:n,shouldOptimize:s})=>{i.filter((t=>e[t.type])).forEach((t=>e[t.type]({root:r,props:o,action:t.data,timestamp:n,shouldOptimize:s}))),t&&t({root:r,props:o,actions:i,timestamp:n,shouldOptimize:s})},insertBefore=(e,t)=>t.parentNode.insertBefore(e,t),insertAfter=(e,t)=>t.parentNode.insertBefore(e,t.nextSibling),isArray=e=>Array.isArray(e),isEmpty=e=>null==e,trim=e=>e.trim(),toString=e=>""+e,toArray=(e,t=",")=>isEmpty(e)?[]:isArray(e)?e:toString(e).split(t).map(trim).filter((e=>e.length)),isBoolean=e=>"boolean"==typeof e,toBoolean=e=>isBoolean(e)?e:"true"===e,isString=e=>"string"==typeof e,toNumber=e=>isNumber(e)?e:isString(e)?toString(e).replace(/[a-z]+/gi,""):0,toInt=e=>parseInt(toNumber(e),10),toFloat=e=>parseFloat(toNumber(e)),isInt=e=>isNumber(e)&&isFinite(e)&&Math.floor(e)===e,toBytes=(e,t=1e3)=>{if(isInt(e))return e;let r=toString(e).trim();return/MB$/i.test(r)?(r=r.replace(/MB$i/,"").trim(),toInt(r)*t*t):/KB/i.test(r)?(r=r.replace(/KB$i/,"").trim(),toInt(r)*t):toInt(r)},isFunction=e=>"function"==typeof e,toFunctionReference=e=>{let t=self,r=e.split("."),o=null;for(;o=r.shift();)if(t=t[o],!t)return null;return t},methods={process:"POST",patch:"PATCH",revert:"DELETE",fetch:"GET",restore:"GET",load:"GET"},createServerAPI=e=>{const t={};return t.url=isString(e)?e:e.url||"",t.timeout=e.timeout?parseInt(e.timeout,10):0,t.headers=e.headers?e.headers:{},forin(methods,(r=>{t[r]=createAction(r,e[r],methods[r],t.timeout,t.headers)})),t.process=e.process||isString(e)||e.url?t.process:null,t.remove=e.remove||null,delete t.headers,t},createAction=(e,t,r,o,i)=>{if(null===t)return null;if("function"==typeof t)return t;const n={url:"GET"===r||"PATCH"===r?`?${e}=`:"",method:r,headers:i,withCredentials:!1,timeout:o,onload:null,ondata:null,onerror:null};if(isString(t))return n.url=t,n;if(Object.assign(n,t),isString(n.headers)){const e=n.headers.split(/:(.+)/);n.headers={header:e[0],value:e[1]}}return n.withCredentials=toBoolean(n.withCredentials),n},toServerAPI=e=>createServerAPI(e),isNull=e=>null===e,isObject=e=>"object"==typeof e&&null!==e,isAPI=e=>isObject(e)&&isString(e.url)&&isObject(e.process)&&isObject(e.revert)&&isObject(e.restore)&&isObject(e.fetch),getType=e=>isArray(e)?"array":isNull(e)?"null":isInt(e)?"int":/^[0-9]+ ?(?:GB|MB|KB)$/gi.test(e)?"bytes":isAPI(e)?"api":typeof e,replaceSingleQuotes=e=>e.replace(/{\s*'/g,'{"').replace(/'\s*}/g,'"}').replace(/'\s*:/g,'":').replace(/:\s*'/g,':"').replace(/,\s*'/g,',"').replace(/'\s*,/g,'",'),conversionTable={array:toArray,boolean:toBoolean,int:e=>"bytes"===getType(e)?toBytes(e):toInt(e),number:toFloat,float:toFloat,bytes:toBytes,string:e=>isFunction(e)?e:toString(e),function:e=>toFunctionReference(e),serverapi:toServerAPI,object:e=>{try{return JSON.parse(e.replace(/{\s*'/g,'{"').replace(/'\s*}/g,'"}').replace(/'\s*:/g,'":').replace(/:\s*'/g,':"').replace(/,\s*'/g,',"').replace(/'\s*,/g,'",'))}catch(e){return null}}},convertTo=(e,t)=>conversionTable[t](e),getValueByType=(e,t,r)=>{if(e===t)return e;let o=getType(e);if(o!==r){const t=(i=e,conversionTable[r](i));if(o=getType(t),null===t)throw`Trying to assign value with incorrect type to "${option}", allowed type: "${r}"`;e=t}var i;return e},createOption=(e,t)=>{let r=e;return{enumerable:!0,get:()=>r,set:o=>{r=getValueByType(o,e,t)}}},createOptions=e=>{const t={};return forin(e,(r=>{const o=e[r];t[r]=createOption(o[0],o[1])})),createObject(t)},createInitialState=e=>({items:[],listUpdateTimeout:null,itemUpdateTimeout:null,processingQueue:[],options:createOptions(e)}),fromCamels=(e,t="-")=>e.split(/(?=[A-Z])/).map((e=>e.toLowerCase())).join(t),createOptionAPI=(e,t)=>{const r={};return forin(t,(t=>{r[t]={get:()=>e.getState().options[t],set:r=>{e.dispatch(`SET_${fromCamels(t,"_").toUpperCase()}`,{value:r})}}})),r},createOptionActions=e=>(t,r,o)=>{const i={};return forin(e,(e=>{const r=fromCamels(e,"_").toUpperCase();i[`SET_${r}`]=i=>{try{o.options[e]=i.value}catch(e){}t(`DID_SET_${r}`,{value:o.options[e]})}})),i},createOptionQueries=e=>t=>{const r={};return forin(e,(e=>{r[`GET_${fromCamels(e,"_").toUpperCase()}`]=r=>t.options[e]})),r},InteractionMethod={API:1,DROP:2,BROWSE:3,PASTE:4,NONE:5},getUniqueId=()=>Math.random().toString(36).substr(2,9),arrayRemove=(e,t)=>e.splice(t,1),run=(e,t)=>{t?e():document.hidden?Promise.resolve(1).then(e):setTimeout(e,0)},on=()=>{const e=[],t=(t,r)=>{arrayRemove(e,e.findIndex((e=>e.event===t&&(e.cb===r||!r))))},r=(t,r,o)=>{e.filter((e=>e.event===t)).map((e=>e.cb)).forEach((e=>run((()=>e(...r)),o)))};return{fireSync:(e,...t)=>{r(e,t,!0)},fire:(e,...t)=>{r(e,t,!1)},on:(t,r)=>{e.push({event:t,cb:r})},onOnce:(r,o)=>{e.push({event:r,cb:(...e)=>{t(r,o),o(...e)}})},off:t}},copyObjectPropertiesToObject=(e,t,r)=>{Object.getOwnPropertyNames(e).filter((e=>!r.includes(e))).forEach((r=>Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))))},PRIVATE=["fire","process","revert","load","on","off","onOnce","retryLoad","extend","archive","archived","release","released","requestProcessing","freeze"],createItemAPI=e=>{const t={};return copyObjectPropertiesToObject(e,t,PRIVATE),t},removeReleasedItems=e=>{e.forEach(((t,r)=>{t.released&&arrayRemove(e,r)}))},ItemStatus={INIT:1,IDLE:2,PROCESSING_QUEUED:9,PROCESSING:3,PROCESSING_COMPLETE:5,PROCESSING_ERROR:6,PROCESSING_REVERT_ERROR:10,LOADING:7,LOAD_ERROR:8},FileOrigin={INPUT:1,LIMBO:2,LOCAL:3},getNonNumeric=e=>/[^0-9]+/.exec(e),getDecimalSeparator=()=>getNonNumeric(1.1.toLocaleString())[0],getThousandsSeparator=()=>{const e=getDecimalSeparator(),t=1e3.toLocaleString();return t!==1e3.toString()?getNonNumeric(t)[0]:"."===e?",":"."},Type={BOOLEAN:"boolean",INT:"int",NUMBER:"number",STRING:"string",ARRAY:"array",OBJECT:"object",FUNCTION:"function",ACTION:"action",SERVER_API:"serverapi",REGEX:"regex"},filters=[],applyFilterChain=(e,t,r)=>new Promise(((o,i)=>{const n=filters.filter((t=>t.key===e)).map((e=>e.cb));if(0===n.length)return void o(t);const s=n.shift();n.reduce(((e,t)=>e.then((e=>t(e,r)))),s(t,r)).then((e=>o(e))).catch((e=>i(e)))})),applyFilters=(e,t,r)=>filters.filter((t=>t.key===e)).map((e=>e.cb(t,r))),addFilter=(e,t)=>filters.push({key:e,cb:t}),extendDefaultOptions=e=>Object.assign(defaultOptions,e),getOptions=()=>({...defaultOptions}),setOptions=e=>{forin(e,((e,t)=>{defaultOptions[e]&&(defaultOptions[e][0]=getValueByType(t,defaultOptions[e][0],defaultOptions[e][1]))}))},defaultOptions={id:[null,Type.STRING],name:["filepond",Type.STRING],disabled:[!1,Type.BOOLEAN],className:[null,Type.STRING],required:[!1,Type.BOOLEAN],captureMethod:[null,Type.STRING],allowSyncAcceptAttribute:[!0,Type.BOOLEAN],allowDrop:[!0,Type.BOOLEAN],allowBrowse:[!0,Type.BOOLEAN],allowPaste:[!0,Type.BOOLEAN],allowMultiple:[!1,Type.BOOLEAN],allowReplace:[!0,Type.BOOLEAN],allowRevert:[!0,Type.BOOLEAN],allowRemove:[!0,Type.BOOLEAN],allowProcess:[!0,Type.BOOLEAN],allowReorder:[!1,Type.BOOLEAN],allowDirectoriesOnly:[!1,Type.BOOLEAN],storeAsFile:[!1,Type.BOOLEAN],forceRevert:[!1,Type.BOOLEAN],maxFiles:[null,Type.INT],checkValidity:[!1,Type.BOOLEAN],itemInsertLocationFreedom:[!0,Type.BOOLEAN],itemInsertLocation:["before",Type.STRING],itemInsertInterval:[75,Type.INT],dropOnPage:[!1,Type.BOOLEAN],dropOnElement:[!0,Type.BOOLEAN],dropValidation:[!1,Type.BOOLEAN],ignoredFiles:[[".ds_store","thumbs.db","desktop.ini"],Type.ARRAY],instantUpload:[!0,Type.BOOLEAN],maxParallelUploads:[2,Type.INT],allowMinimumUploadDuration:[!0,Type.BOOLEAN],chunkUploads:[!1,Type.BOOLEAN],chunkForce:[!1,Type.BOOLEAN],chunkSize:[5e6,Type.INT],chunkRetryDelays:[[500,1e3,3e3],Type.ARRAY],server:[null,Type.SERVER_API],fileSizeBase:[1e3,Type.INT],labelFileSizeBytes:["bytes",Type.STRING],labelFileSizeKilobytes:["KB",Type.STRING],labelFileSizeMegabytes:["MB",Type.STRING],labelFileSizeGigabytes:["GB",Type.STRING],labelDecimalSeparator:[getDecimalSeparator(),Type.STRING],labelThousandsSeparator:[getThousandsSeparator(),Type.STRING],labelIdle:['Drag & Drop your files or <span class="filepond--label-action">Browse</span>',Type.STRING],labelInvalidField:["Field contains invalid files",Type.STRING],labelFileWaitingForSize:["Waiting for size",Type.STRING],labelFileSizeNotAvailable:["Size not available",Type.STRING],labelFileCountSingular:["file in list",Type.STRING],labelFileCountPlural:["files in list",Type.STRING],labelFileLoading:["Loading",Type.STRING],labelFileAdded:["Added",Type.STRING],labelFileLoadError:["Error during load",Type.STRING],labelFileRemoved:["Removed",Type.STRING],labelFileRemoveError:["Error during remove",Type.STRING],labelFileProcessing:["Uploading",Type.STRING],labelFileProcessingComplete:["Upload complete",Type.STRING],labelFileProcessingAborted:["Upload cancelled",Type.STRING],labelFileProcessingError:["Error during upload",Type.STRING],labelFileProcessingRevertError:["Error during revert",Type.STRING],labelTapToCancel:["tap to cancel",Type.STRING],labelTapToRetry:["tap to retry",Type.STRING],labelTapToUndo:["tap to undo",Type.STRING],labelButtonRemoveItem:["Remove",Type.STRING],labelButtonAbortItemLoad:["Abort",Type.STRING],labelButtonRetryItemLoad:["Retry",Type.STRING],labelButtonAbortItemProcessing:["Cancel",Type.STRING],labelButtonUndoItemProcessing:["Undo",Type.STRING],labelButtonRetryItemProcessing:["Retry",Type.STRING],labelButtonProcessItem:["Upload",Type.STRING],iconRemove:['<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg"><path d="M11.586 13l-2.293 2.293a1 1 0 0 0 1.414 1.414L13 14.414l2.293 2.293a1 1 0 0 0 1.414-1.414L14.414 13l2.293-2.293a1 1 0 0 0-1.414-1.414L13 11.586l-2.293-2.293a1 1 0 0 0-1.414 1.414L11.586 13z" fill="currentColor" fill-rule="nonzero"/></svg>',Type.STRING],iconProcess:['<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg"><path d="M14 10.414v3.585a1 1 0 0 1-2 0v-3.585l-1.293 1.293a1 1 0 0 1-1.414-1.415l3-3a1 1 0 0 1 1.414 0l3 3a1 1 0 0 1-1.414 1.415L14 10.414zM9 18a1 1 0 0 1 0-2h8a1 1 0 0 1 0 2H9z" fill="currentColor" fill-rule="evenodd"/></svg>',Type.STRING],iconRetry:['<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg"><path d="M10.81 9.185l-.038.02A4.997 4.997 0 0 0 8 13.683a5 5 0 0 0 5 5 5 5 0 0 0 5-5 1 1 0 0 1 2 0A7 7 0 1 1 9.722 7.496l-.842-.21a.999.999 0 1 1 .484-1.94l3.23.806c.535.133.86.675.73 1.21l-.804 3.233a.997.997 0 0 1-1.21.73.997.997 0 0 1-.73-1.21l.23-.928v-.002z" fill="currentColor" fill-rule="nonzero"/></svg>',Type.STRING],iconUndo:['<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg"><path d="M9.185 10.81l.02-.038A4.997 4.997 0 0 1 13.683 8a5 5 0 0 1 5 5 5 5 0 0 1-5 5 1 1 0 0 0 0 2A7 7 0 1 0 7.496 9.722l-.21-.842a.999.999 0 1 0-1.94.484l.806 3.23c.133.535.675.86 1.21.73l3.233-.803a.997.997 0 0 0 .73-1.21.997.997 0 0 0-1.21-.73l-.928.23-.002-.001z" fill="currentColor" fill-rule="nonzero"/></svg>',Type.STRING],iconDone:['<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg"><path d="M18.293 9.293a1 1 0 0 1 1.414 1.414l-7.002 7a1 1 0 0 1-1.414 0l-3.998-4a1 1 0 1 1 1.414-1.414L12 15.586l6.294-6.293z" fill="currentColor" fill-rule="nonzero"/></svg>',Type.STRING],oninit:[null,Type.FUNCTION],onwarning:[null,Type.FUNCTION],onerror:[null,Type.FUNCTION],onactivatefile:[null,Type.FUNCTION],oninitfile:[null,Type.FUNCTION],onaddfilestart:[null,Type.FUNCTION],onaddfileprogress:[null,Type.FUNCTION],onaddfile:[null,Type.FUNCTION],onprocessfilestart:[null,Type.FUNCTION],onprocessfileprogress:[null,Type.FUNCTION],onprocessfileabort:[null,Type.FUNCTION],onprocessfilerevert:[null,Type.FUNCTION],onprocessfile:[null,Type.FUNCTION],onprocessfiles:[null,Type.FUNCTION],onremovefile:[null,Type.FUNCTION],onpreparefile:[null,Type.FUNCTION],onupdatefiles:[null,Type.FUNCTION],onreorderfiles:[null,Type.FUNCTION],beforeDropFile:[null,Type.FUNCTION],beforeAddFile:[null,Type.FUNCTION],beforeRemoveFile:[null,Type.FUNCTION],beforePrepareFile:[null,Type.FUNCTION],stylePanelLayout:[null,Type.STRING],stylePanelAspectRatio:[null,Type.STRING],styleItemPanelAspectRatio:[null,Type.STRING],styleButtonRemoveItemPosition:["left",Type.STRING],styleButtonProcessItemPosition:["right",Type.STRING],styleLoadIndicatorPosition:["right",Type.STRING],styleProgressIndicatorPosition:["right",Type.STRING],styleButtonRemoveItemAlign:[!1,Type.BOOLEAN],files:[[],Type.ARRAY],credits:[["https://pqina.nl/","Powered by PQINA"],Type.ARRAY]},getItemByQuery=(e,t)=>isEmpty(t)?e[0]||null:isInt(t)?e[t]||null:("object"==typeof t&&(t=t.id),e.find((e=>e.id===t))||null),getNumericAspectRatioFromString=e=>{if(isEmpty(e))return e;if(/:/.test(e)){const t=e.split(":");return t[1]/t[0]}return parseFloat(e)},getActiveItems=e=>e.filter((e=>!e.archived)),Status={EMPTY:0,IDLE:1,ERROR:2,BUSY:3,READY:4};let res=null;const canUpdateFileInput=()=>{if(null===res)try{const e=new DataTransfer;e.items.add(new File(["hello world"],"This_Works.txt"));const t=document.createElement("input");t.setAttribute("type","file"),t.files=e.files,res=1===t.files.length}catch(e){res=!1}return res},ITEM_ERROR=[ItemStatus.LOAD_ERROR,ItemStatus.PROCESSING_ERROR,ItemStatus.PROCESSING_REVERT_ERROR],ITEM_BUSY=[ItemStatus.LOADING,ItemStatus.PROCESSING,ItemStatus.PROCESSING_QUEUED,ItemStatus.INIT],ITEM_READY=[ItemStatus.PROCESSING_COMPLETE],isItemInErrorState=e=>ITEM_ERROR.includes(e.status),isItemInBusyState=e=>ITEM_BUSY.includes(e.status),isItemInReadyState=e=>ITEM_READY.includes(e.status),isAsync=e=>isObject(e.options.server)&&(isObject(e.options.server.process)||isFunction(e.options.server.process)),queries=e=>({GET_STATUS:()=>{const t=getActiveItems(e.items),{EMPTY:r,ERROR:o,BUSY:i,IDLE:n,READY:s}=Status;return 0===t.length?r:t.some(isItemInErrorState)?o:t.some(isItemInBusyState)?i:t.some(isItemInReadyState)?s:n},GET_ITEM:t=>getItemByQuery(e.items,t),GET_ACTIVE_ITEM:t=>getItemByQuery(getActiveItems(e.items),t),GET_ACTIVE_ITEMS:()=>getActiveItems(e.items),GET_ITEMS:()=>e.items,GET_ITEM_NAME:t=>{const r=getItemByQuery(e.items,t);return r?r.filename:null},GET_ITEM_SIZE:t=>{const r=getItemByQuery(e.items,t);return r?r.fileSize:null},GET_STYLES:()=>Object.keys(e.options).filter((e=>/^style/.test(e))).map((t=>({name:t,value:e.options[t]}))),GET_PANEL_ASPECT_RATIO:()=>/circle/.test(e.options.stylePanelLayout)?1:getNumericAspectRatioFromString(e.options.stylePanelAspectRatio),GET_ITEM_PANEL_ASPECT_RATIO:()=>e.options.styleItemPanelAspectRatio,GET_ITEMS_BY_STATUS:t=>getActiveItems(e.items).filter((e=>e.status===t)),GET_TOTAL_ITEMS:()=>getActiveItems(e.items).length,SHOULD_UPDATE_FILE_INPUT:()=>e.options.storeAsFile&&canUpdateFileInput()&&!isAsync(e),IS_ASYNC:()=>isAsync(e),GET_FILE_SIZE_LABELS:e=>({labelBytes:e("GET_LABEL_FILE_SIZE_BYTES")||void 0,labelKilobytes:e("GET_LABEL_FILE_SIZE_KILOBYTES")||void 0,labelMegabytes:e("GET_LABEL_FILE_SIZE_MEGABYTES")||void 0,labelGigabytes:e("GET_LABEL_FILE_SIZE_GIGABYTES")||void 0})}),hasRoomForItem=e=>{const t=getActiveItems(e.items).length;if(!e.options.allowMultiple)return 0===t;const r=e.options.maxFiles;return null===r||t<r},limit=(e,t,r)=>Math.max(Math.min(r,e),t),arrayInsert=(e,t,r)=>e.splice(t,0,r),insertItem=(e,t,r)=>isEmpty(t)?null:void 0===r?(e.push(t),t):(r=limit(r,0,e.length),arrayInsert(e,r,t),t),isBase64DataURI=e=>/^\s*data:([a-z]+\/[a-z0-9-+.]+(;[a-z-]+=[a-z0-9-]+)?)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s]*)\s*$/i.test(e),getFilenameFromURL=e=>e.split("/").pop().split("?").shift(),getExtensionFromFilename=e=>e.split(".").pop(),guesstimateExtension=e=>{if("string"!=typeof e)return"";const t=e.split("/").pop();return/svg/.test(t)?"svg":/zip|compressed/.test(t)?"zip":/plain/.test(t)?"txt":/msword/.test(t)?"doc":/[a-z]+/.test(t)?"jpeg"===t?"jpg":t:""},leftPad=(e,t="")=>(t+e).slice(-t.length),getDateString=(e=new Date)=>`${e.getFullYear()}-${leftPad(e.getMonth()+1,"00")}-${leftPad(e.getDate(),"00")}_${leftPad(e.getHours(),"00")}-${leftPad(e.getMinutes(),"00")}-${leftPad(e.getSeconds(),"00")}`,getFileFromBlob=(e,t,r=null,o=null)=>{const i="string"==typeof r?e.slice(0,e.size,r):e.slice(0,e.size,e.type);return i.lastModifiedDate=new Date,e._relativePath&&(i._relativePath=e._relativePath),isString(t)||(t=getDateString()),t&&null===o&&getExtensionFromFilename(t)?i.name=t:(o=o||guesstimateExtension(i.type),i.name=t+(o?"."+o:"")),i},getBlobBuilder=()=>window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,createBlob=(e,t)=>{const r=window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(r){const o=new r;return o.append(e),o.getBlob(t)}return new Blob([e],{type:t})},getBlobFromByteStringWithMimeType=(e,t)=>{const r=new ArrayBuffer(e.length),o=new Uint8Array(r);for(let t=0;t<e.length;t++)o[t]=e.charCodeAt(t);return createBlob(r,t)},getMimeTypeFromBase64DataURI=e=>(/^data:(.+);/.exec(e)||[])[1]||null,getBase64DataFromBase64DataURI=e=>e.split(",")[1].replace(/\s/g,""),getByteStringFromBase64DataURI=e=>atob(getBase64DataFromBase64DataURI(e)),getBlobFromBase64DataURI=e=>{const t=getMimeTypeFromBase64DataURI(e),r=getByteStringFromBase64DataURI(e);return getBlobFromByteStringWithMimeType(r,t)},getFileFromBase64DataURI=(e,t,r)=>getFileFromBlob(getBlobFromBase64DataURI(e),t,null,r),getFileNameFromHeader=e=>{if(!/^content-disposition:/i.test(e))return null;const t=e.split(/filename=|filename\*=.+''/).splice(1).map((e=>e.trim().replace(/^["']|[;"']{0,2}$/g,""))).filter((e=>e.length));return t.length?decodeURI(t[t.length-1]):null},getFileSizeFromHeader=e=>{if(/content-length:/i.test(e)){const t=e.match(/[0-9]+/)[0];return t?parseInt(t,10):null}return null},getTranfserIdFromHeader=e=>{if(/x-content-transfer-id:/i.test(e)){return(e.split(":")[1]||"").trim()||null}return null},getFileInfoFromHeaders=e=>{const t={source:null,name:null,size:null},r=e.split("\n");for(let e of r){const r=getFileNameFromHeader(e);if(r){t.name=r;continue}const o=getFileSizeFromHeader(e);if(o){t.size=o;continue}const i=getTranfserIdFromHeader(e);i&&(t.source=i)}return t},createFileLoader=e=>{const t={source:null,complete:!1,progress:0,size:null,timestamp:null,duration:0,request:null},r=r=>{e?(t.timestamp=Date.now(),t.request=e(r,(e=>{t.duration=Date.now()-t.timestamp,t.complete=!0,e instanceof Blob&&(e=getFileFromBlob(e,e.name||getFilenameFromURL(r))),o.fire("load",e instanceof Blob?e:e?e.body:null)}),(e=>{o.fire("error","string"==typeof e?{type:"error",code:0,body:e}:e)}),((e,r,i)=>{i&&(t.size=i),t.duration=Date.now()-t.timestamp,e?(t.progress=r/i,o.fire("progress",t.progress)):t.progress=null}),(()=>{o.fire("abort")}),(e=>{const r=getFileInfoFromHeaders("string"==typeof e?e:e.headers);o.fire("meta",{size:t.size||r.size,filename:r.name,source:r.source})}))):o.fire("error",{type:"error",body:"Can't load URL",code:400})},o={...on(),setSource:e=>t.source=e,getProgress:()=>t.progress,abort:()=>{t.request&&t.request.abort&&t.request.abort()},load:()=>{const e=t.source;var i,n;o.fire("init",e),e instanceof File?o.fire("load",e):e instanceof Blob?o.fire("load",getFileFromBlob(e,e.name)):isBase64DataURI(e)?o.fire("load",getFileFromBlob(getBlobFromBase64DataURI(e),i,null,n)):r(e)}};return o},isGet=e=>/GET|HEAD/.test(e),sendRequest=(e,t,r)=>{const o={onheaders:()=>{},onprogress:()=>{},onload:()=>{},ontimeout:()=>{},onerror:()=>{},onabort:()=>{},abort:()=>{i=!0,s.abort()}};let i=!1,n=!1;r={method:"POST",headers:{},withCredentials:!1,...r},t=encodeURI(t),isGet(r.method)&&e&&(t=`${t}${encodeURIComponent("string"==typeof e?e:JSON.stringify(e))}`);const s=new XMLHttpRequest;return(isGet(r.method)?s:s.upload).onprogress=e=>{i||o.onprogress(e.lengthComputable,e.loaded,e.total)},s.onreadystatechange=()=>{s.readyState<2||4===s.readyState&&0===s.status||n||(n=!0,o.onheaders(s))},s.onload=()=>{s.status>=200&&s.status<300?o.onload(s):o.onerror(s)},s.onerror=()=>o.onerror(s),s.onabort=()=>{i=!0,o.onabort()},s.ontimeout=()=>o.ontimeout(s),s.open(r.method,t,!0),isInt(r.timeout)&&(s.timeout=r.timeout),Object.keys(r.headers).forEach((e=>{const t=unescape(encodeURIComponent(r.headers[e]));s.setRequestHeader(e,t)})),r.responseType&&(s.responseType=r.responseType),r.withCredentials&&(s.withCredentials=!0),s.send(e),o},createResponse=(e,t,r,o)=>({type:e,code:t,body:r,headers:o}),createTimeoutResponse=e=>t=>{e(createResponse("error",0,"Timeout",t.getAllResponseHeaders()))},hasQS=e=>/\?/.test(e),buildURL=(...e)=>{let t="";return e.forEach((e=>{t+=hasQS(t)&&hasQS(e)?e.replace(/\?/,"&"):e})),t},createFetchFunction=(e="",t)=>{if("function"==typeof t)return t;if(!t||!isString(t.url))return null;const r=t.onload||(e=>e),o=t.onerror||(e=>null);return(i,n,s,a,l,c)=>{const d=sendRequest(i,buildURL(e,t.url),{...t,responseType:"blob"});return d.onload=e=>{const o=e.getAllResponseHeaders(),s=getFileInfoFromHeaders(o).name||getFilenameFromURL(i);n(createResponse("load",e.status,"HEAD"===t.method?null:getFileFromBlob(r(e.response),s),o))},d.onerror=e=>{s(createResponse("error",e.status,o(e.response)||e.statusText,e.getAllResponseHeaders()))},d.onheaders=e=>{c(createResponse("headers",e.status,null,e.getAllResponseHeaders()))},d.ontimeout=createTimeoutResponse(s),d.onprogress=a,d.onabort=l,d}},ChunkStatus={QUEUED:0,COMPLETE:1,PROCESSING:2,ERROR:3,WAITING:4},processFileChunked=(e,t,r,o,i,n,s,a,l,c,d)=>{const p=[],{chunkTransferId:u,chunkServer:E,chunkSize:m,chunkRetryDelays:I}=d,T={serverId:u,aborted:!1},f=t.ondata||(e=>e),g=t.onload||((e,t)=>"HEAD"===t?e.getResponseHeader("Upload-Offset"):e.response),_=t.onerror||(e=>null),R=Math.floor(o.size/m);for(let e=0;e<=R;e++){const t=e*m,r=o.slice(t,t+m,"application/offset+octet-stream");p[e]={index:e,size:r.size,offset:t,data:r,file:o,progress:0,retries:[...I],status:ChunkStatus.QUEUED,error:null,request:null,timeout:null}}const h=e=>e.status===ChunkStatus.QUEUED||e.status===ChunkStatus.ERROR,y=t=>{if(T.aborted)return;if(!(t=t||p.find(h)))return void(p.every((e=>e.status===ChunkStatus.COMPLETE))&&n(T.serverId));t.status=ChunkStatus.PROCESSING,t.progress=null;const r=E.ondata||(e=>e),i=E.onerror||(e=>null),a=buildURL(e,E.url,T.serverId),c="function"==typeof E.headers?E.headers(t):{...E.headers,"Content-Type":"application/offset+octet-stream","Upload-Offset":t.offset,"Upload-Length":o.size,"Upload-Name":o.name},d=t.request=sendRequest(r(t.data),a,{...E,headers:c});d.onload=()=>{t.status=ChunkStatus.COMPLETE,t.request=null,D()},d.onprogress=(e,r,o)=>{t.progress=e?r:null,S()},d.onerror=e=>{t.status=ChunkStatus.ERROR,t.request=null,t.error=i(e.response)||e.statusText,O(t)||s(createResponse("error",e.status,i(e.response)||e.statusText,e.getAllResponseHeaders()))},d.ontimeout=e=>{t.status=ChunkStatus.ERROR,t.request=null,O(t)||createTimeoutResponse(s)(e)},d.onabort=()=>{t.status=ChunkStatus.QUEUED,t.request=null,l()}},O=e=>0!==e.retries.length&&(e.status=ChunkStatus.WAITING,clearTimeout(e.timeout),e.timeout=setTimeout((()=>{y(e)}),e.retries.shift()),!0),S=()=>{const e=p.reduce(((e,t)=>null===e||null===t.progress?null:e+t.progress),0);if(null===e)return a(!1,0,0);const t=p.reduce(((e,t)=>e+t.size),0);a(!0,e,t)},D=()=>{p.filter((e=>e.status===ChunkStatus.PROCESSING)).length>=1||y()};return T.serverId?(r=>{const o=buildURL(e,E.url,T.serverId),i={headers:"function"==typeof t.headers?t.headers(T.serverId):{...t.headers},method:"HEAD"},n=sendRequest(null,o,i);n.onload=e=>r(g(e,i.method)),n.onerror=e=>s(createResponse("error",e.status,_(e.response)||e.statusText,e.getAllResponseHeaders())),n.ontimeout=createTimeoutResponse(s)})((e=>{T.aborted||(p.filter((t=>t.offset<e)).forEach((e=>{e.status=ChunkStatus.COMPLETE,e.progress=e.size})),D())})):(n=>{const a=new FormData;isObject(i)&&a.append(r,JSON.stringify(i));const l="function"==typeof t.headers?t.headers(o,i):{...t.headers,"Upload-Length":o.size},c={...t,headers:l},d=sendRequest(f(a),buildURL(e,t.url),c);d.onload=e=>n(g(e,c.method)),d.onerror=e=>s(createResponse("error",e.status,_(e.response)||e.statusText,e.getAllResponseHeaders())),d.ontimeout=createTimeoutResponse(s)})((e=>{T.aborted||(c(e),T.serverId=e,D())})),{abort:()=>{T.aborted=!0,p.forEach((e=>{clearTimeout(e.timeout),e.request&&e.request.abort()}))}}},createFileProcessorFunction=(e,t,r,o)=>(i,n,s,a,l,c,d)=>{if(!i)return;const p=o.chunkUploads,u=p&&i.size>o.chunkSize,E=p&&(u||o.chunkForce);if(i instanceof Blob&&E)return processFileChunked(e,t,r,i,n,s,a,l,c,d,o);const m=t.ondata||(e=>e),I=t.onload||(e=>e),T=t.onerror||(e=>null),f="function"==typeof t.headers?t.headers(i,n)||{}:{...t.headers},g={...t,headers:f};var _=new FormData;isObject(n)&&_.append(r,JSON.stringify(n)),(i instanceof Blob?[{name:null,file:i}]:i).forEach((e=>{_.append(r,e.file,null===e.name?e.file.name:`${e.name}${e.file.name}`)}));const R=sendRequest(m(_),buildURL(e,t.url),g);return R.onload=e=>{s(createResponse("load",e.status,I(e.response),e.getAllResponseHeaders()))},R.onerror=e=>{a(createResponse("error",e.status,T(e.response)||e.statusText,e.getAllResponseHeaders()))},R.ontimeout=createTimeoutResponse(a),R.onprogress=l,R.onabort=c,R},createProcessorFunction=(e="",t,r,o)=>"function"==typeof t?(...e)=>t(r,...e,o):t&&isString(t.url)?createFileProcessorFunction(e,t,r,o):null,createRevertFunction=(e="",t)=>{if("function"==typeof t)return t;if(!t||!isString(t.url))return(e,t)=>t();const r=t.onload||(e=>e),o=t.onerror||(e=>null);return(i,n,s)=>{const a=sendRequest(i,e+t.url,t);return a.onload=e=>{n(createResponse("load",e.status,r(e.response),e.getAllResponseHeaders()))},a.onerror=e=>{s(createResponse("error",e.status,o(e.response)||e.statusText,e.getAllResponseHeaders()))},a.ontimeout=createTimeoutResponse(s),a}},getRandomNumber=(e=0,t=1)=>e+Math.random()*(t-e),createPerceivedPerformanceUpdater=(e,t=1e3,r=0,o=25,i=250)=>{let n=null;const s=Date.now(),a=()=>{let r=Date.now()-s,l=getRandomNumber(o,i);r+l>t&&(l=r+l-t);let c=r/t;c>=1||document.hidden?e(1):(e(c),n=setTimeout(a,l))};return t>0&&a(),{clear:()=>{clearTimeout(n)}}},createFileProcessor=(e,t)=>{const r={complete:!1,perceivedProgress:0,perceivedPerformanceUpdater:null,progress:null,timestamp:null,perceivedDuration:0,duration:0,request:null,response:null},{allowMinimumUploadDuration:o}=t,i=()=>{r.request&&(r.perceivedPerformanceUpdater.clear(),r.request.abort&&r.request.abort(),r.complete=!0)},n=o?()=>r.progress?Math.min(r.progress,r.perceivedProgress):null:()=>r.progress||null,s=o?()=>Math.min(r.duration,r.perceivedDuration):()=>r.duration,a={...on(),process:(t,i)=>{const n=()=>{0!==r.duration&&null!==r.progress&&a.fire("progress",a.getProgress())},s=()=>{r.complete=!0,a.fire("load-perceived",r.response.body)};a.fire("start"),r.timestamp=Date.now(),r.perceivedPerformanceUpdater=createPerceivedPerformanceUpdater((e=>{r.perceivedProgress=e,r.perceivedDuration=Date.now()-r.timestamp,n(),r.response&&1===r.perceivedProgress&&!r.complete&&s()}),o?getRandomNumber(750,1500):0),r.request=e(t,i,(e=>{r.response=isObject(e)?e:{type:"load",code:200,body:`${e}`,headers:{}},r.duration=Date.now()-r.timestamp,r.progress=1,a.fire("load",r.response.body),(!o||o&&1===r.perceivedProgress)&&s()}),(e=>{r.perceivedPerformanceUpdater.clear(),a.fire("error",isObject(e)?e:{type:"error",code:0,body:`${e}`})}),((e,t,o)=>{r.duration=Date.now()-r.timestamp,r.progress=e?t/o:null,n()}),(()=>{r.perceivedPerformanceUpdater.clear(),a.fire("abort",r.response?r.response.body:null)}),(e=>{a.fire("transfer",e)}))},abort:i,getProgress:n,getDuration:s,reset:()=>{i(),r.complete=!1,r.perceivedProgress=0,r.progress=0,r.timestamp=null,r.perceivedDuration=0,r.duration=0,r.request=null,r.response=null}};return a},getFilenameWithoutExtension=e=>e.substr(0,e.lastIndexOf("."))||e,createFileStub=e=>{let t=[e.name,e.size,e.type];return e instanceof Blob||isBase64DataURI(e)?t[0]=e.name||getDateString():isBase64DataURI(e)?(t[1]=e.length,t[2]=getMimeTypeFromBase64DataURI(e)):isString(e)&&(t[0]=getFilenameFromURL(e),t[1]=0,t[2]="application/octet-stream"),{name:t[0],size:t[1],type:t[2]}},isFile=e=>!!(e instanceof File||e instanceof Blob&&e.name),deepCloneObject=e=>{if(!isObject(e))return e;const t=isArray(e)?[]:{};for(const r in e){if(!e.hasOwnProperty(r))continue;const o=e[r];t[r]=o&&isObject(o)?deepCloneObject(o):o}return t},createItem=(e=null,t=null,r=null)=>{const o=getUniqueId(),i={archived:!1,frozen:!1,released:!1,source:null,file:r,serverFileReference:t,transferId:null,processingAborted:!1,status:t?ItemStatus.PROCESSING_COMPLETE:ItemStatus.INIT,activeLoader:null,activeProcessor:null};let n=null;const s={},a=e=>i.status=e,l=(e,...t)=>{i.released||i.frozen||p.fire(e,...t)},c=(e,t)=>{if(i.processingAborted)return void(i.processingAborted=!1);if(a(ItemStatus.PROCESSING),n=null,!(i.file instanceof Blob))return void p.on("load",(()=>{c(e,t)}));e.on("load",(e=>{i.transferId=null,i.serverFileReference=e})),e.on("transfer",(e=>{i.transferId=e})),e.on("load-perceived",(e=>{i.activeProcessor=null,i.transferId=null,i.serverFileReference=e,a(ItemStatus.PROCESSING_COMPLETE),l("process-complete",e)})),e.on("start",(()=>{l("process-start")})),e.on("error",(e=>{i.activeProcessor=null,a(ItemStatus.PROCESSING_ERROR),l("process-error",e)})),e.on("abort",(e=>{i.activeProcessor=null,i.serverFileReference=e,a(ItemStatus.IDLE),l("process-abort"),n&&n()})),e.on("progress",(e=>{l("process-progress",e)}));const r=console.error;t(i.file,(t=>{i.archived||e.process(t,{...s})}),r),i.activeProcessor=e},d=(e,t,r)=>{const o=e.split("."),i=o[0],n=o.pop();let a=s;o.forEach((e=>a=a[e])),JSON.stringify(a[n])!==JSON.stringify(t)&&(a[n]=t,l("metadata-update",{key:i,value:s[i],silent:r}))},p={id:{get:()=>o},origin:{get:()=>e,set:t=>e=t},serverId:{get:()=>i.serverFileReference},transferId:{get:()=>i.transferId},status:{get:()=>i.status},filename:{get:()=>i.file.name},filenameWithoutExtension:{get:()=>getFilenameWithoutExtension(i.file.name)},fileExtension:{get:()=>getExtensionFromFilename(i.file.name)},fileType:{get:()=>i.file.type},fileSize:{get:()=>i.file.size},file:{get:()=>i.file},relativePath:{get:()=>i.file._relativePath},source:{get:()=>i.source},getMetadata:e=>deepCloneObject(e?s[e]:s),setMetadata:(e,t,r)=>{if(isObject(e)){const r=e;return Object.keys(r).forEach((e=>{d(e,r[e],t)})),e}return d(e,t,r),t},extend:(e,t)=>u[e]=t,abortLoad:()=>{i.activeLoader?i.activeLoader.abort():(a(ItemStatus.INIT),l("load-abort"))},retryLoad:()=>{i.activeLoader&&i.activeLoader.load()},requestProcessing:()=>{i.processingAborted=!1,a(ItemStatus.PROCESSING_QUEUED)},abortProcessing:()=>new Promise((e=>{if(!i.activeProcessor)return i.processingAborted=!0,a(ItemStatus.IDLE),l("process-abort"),void e();n=()=>{e()},i.activeProcessor.abort()})),load:(t,r,o)=>{i.source=t,p.fireSync("init"),i.file?p.fireSync("load-skip"):(i.file=createFileStub(t),r.on("init",(()=>{l("load-init")})),r.on("meta",(t=>{i.file.size=t.size,i.file.filename=t.filename,t.source&&(e=FileOrigin.LIMBO,i.serverFileReference=t.source,i.status=ItemStatus.PROCESSING_COMPLETE),l("load-meta")})),r.on("progress",(e=>{a(ItemStatus.LOADING),l("load-progress",e)})),r.on("error",(e=>{a(ItemStatus.LOAD_ERROR),l("load-request-error",e)})),r.on("abort",(()=>{a(ItemStatus.INIT),l("load-abort")})),r.on("load",(t=>{i.activeLoader=null;const r=t=>{i.file=isFile(t)?t:i.file,e===FileOrigin.LIMBO&&i.serverFileReference?a(ItemStatus.PROCESSING_COMPLETE):a(ItemStatus.IDLE),l("load")};i.serverFileReference?r(t):o(t,r,(e=>{i.file=t,l("load-meta"),a(ItemStatus.LOAD_ERROR),l("load-file-error",e)}))})),r.setSource(t),i.activeLoader=r,r.load())},process:c,revert:(e,t)=>new Promise(((r,o)=>{const n=null!==i.serverFileReference?i.serverFileReference:i.transferId;null!==n?(e(n,(()=>{i.serverFileReference=null,i.transferId=null,r()}),(e=>{t?(a(ItemStatus.PROCESSING_REVERT_ERROR),l("process-revert-error"),o(e)):r()})),a(ItemStatus.IDLE),l("process-revert")):r()})),...on(),freeze:()=>i.frozen=!0,release:()=>i.released=!0,released:{get:()=>i.released},archive:()=>i.archived=!0,archived:{get:()=>i.archived}},u=createObject(p);return u},getItemIndexByQuery=(e,t)=>isEmpty(t)?0:isString(t)?e.findIndex((e=>e.id===t)):-1,getItemById=(e,t)=>{const r=getItemIndexByQuery(e,t);if(!(r<0))return e[r]||null},fetchBlob=(e,t,r,o,i,n)=>{const s=sendRequest(null,e,{method:"GET",responseType:"blob"});return s.onload=r=>{const o=r.getAllResponseHeaders(),i=getFileInfoFromHeaders(o).name||getFilenameFromURL(e);t(createResponse("load",r.status,getFileFromBlob(r.response,i),o))},s.onerror=e=>{r(createResponse("error",e.status,e.statusText,e.getAllResponseHeaders()))},s.onheaders=e=>{n(createResponse("headers",e.status,null,e.getAllResponseHeaders()))},s.ontimeout=createTimeoutResponse(r),s.onprogress=o,s.onabort=i,s},getDomainFromURL=e=>(0===e.indexOf("//")&&(e=location.protocol+e),e.toLowerCase().replace("blob:","").replace(/([a-z])?:\/\//,"$1").split("/")[0]),isExternalURL=e=>(e.indexOf(":")>-1||e.indexOf("//")>-1)&&getDomainFromURL(location.href)!==getDomainFromURL(e),dynamicLabel=e=>(...t)=>isFunction(e)?e(...t):e,isMockItem=e=>!isFile(e.file),listUpdated=(e,t)=>{clearTimeout(t.listUpdateTimeout),t.listUpdateTimeout=setTimeout((()=>{e("DID_UPDATE_ITEMS",{items:getActiveItems(t.items)})}),0)},optionalPromise=(e,...t)=>new Promise((r=>{if(!e)return r(!0);const o=e(...t);return null==o?r(!0):"boolean"==typeof o?r(o):void("function"==typeof o.then&&o.then(r))})),sortItems=(e,t)=>{e.items.sort(((e,r)=>t(createItemAPI(e),createItemAPI(r))))},getItemByQueryFromState=(e,t)=>({query:r,success:o=(()=>{}),failure:i=(()=>{}),...n}={})=>{const s=getItemByQuery(e.items,r);s?t(s,o,i,n||{}):i({error:createResponse("error",0,"Item not found"),file:null})},actions=(e,t,r)=>({ABORT_ALL:()=>{getActiveItems(r.items).forEach((e=>{e.freeze(),e.abortLoad(),e.abortProcessing()}))},DID_SET_FILES:({value:t=[]})=>{const o=t.map((e=>({source:e.source?e.source:e,options:e.options})));let i=getActiveItems(r.items);i.forEach((t=>{o.find((e=>e.source===t.source||e.source===t.file))||e("REMOVE_ITEM",{query:t,remove:!1})})),i=getActiveItems(r.items),o.forEach(((t,r)=>{i.find((e=>e.source===t.source||e.file===t.source))||e("ADD_ITEM",{...t,interactionMethod:InteractionMethod.NONE,index:r})}))},DID_UPDATE_ITEM_METADATA:({id:o,action:i,change:n})=>{n.silent||(clearTimeout(r.itemUpdateTimeout),r.itemUpdateTimeout=setTimeout((()=>{const s=getItemById(r.items,o);if(!t("IS_ASYNC"))return void applyFilterChain("SHOULD_PREPARE_OUTPUT",!1,{item:s,query:t,action:i,change:n}).then((r=>{const i=t("GET_BEFORE_PREPARE_FILE");i&&(r=i(s,r)),r&&e("REQUEST_PREPARE_OUTPUT",{query:o,item:s,success:t=>{e("DID_PREPARE_OUTPUT",{id:o,file:t})}},!0)}));s.origin===FileOrigin.LOCAL&&e("DID_LOAD_ITEM",{id:s.id,error:null,serverFileReference:s.source});const a=()=>{setTimeout((()=>{e("REQUEST_ITEM_PROCESSING",{query:o})}),32)};return s.status===ItemStatus.PROCESSING_COMPLETE?(l=r.options.instantUpload,void s.revert(createRevertFunction(r.options.server.url,r.options.server.revert),t("GET_FORCE_REVERT")).then(l?a:()=>{}).catch((()=>{}))):s.status===ItemStatus.PROCESSING?(e=>{s.abortProcessing().then(e?a:()=>{})})(r.options.instantUpload):void(r.options.instantUpload&&a());var l}),0))},MOVE_ITEM:({query:e,index:t})=>{const o=getItemByQuery(r.items,e);if(!o)return;const i=r.items.indexOf(o);i!==(t=limit(t,0,r.items.length-1))&&r.items.splice(t,0,r.items.splice(i,1)[0])},SORT:({compare:o})=>{sortItems(r,o),e("DID_SORT_ITEMS",{items:t("GET_ACTIVE_ITEMS")})},ADD_ITEMS:({items:r,index:o,interactionMethod:i,success:n=(()=>{}),failure:s=(()=>{})})=>{let a=o;if(-1===o||void 0===o){const e=t("GET_ITEM_INSERT_LOCATION"),r=t("GET_TOTAL_ITEMS");a="before"===e?0:r}const l=t("GET_IGNORED_FILES"),c=r.filter((e=>isFile(e)?!l.includes(e.name.toLowerCase()):!isEmpty(e))).map((t=>new Promise(((r,o)=>{e("ADD_ITEM",{interactionMethod:i,source:t.source||t,success:r,failure:o,index:a++,options:t.options||{}})}))));Promise.all(c).then(n).catch(s)},ADD_ITEM:({source:o,index:i=-1,interactionMethod:n,success:s=(()=>{}),failure:a=(()=>{}),options:l={}})=>{if(isEmpty(o))return void a({error:createResponse("error",0,"No source"),file:null});if(isFile(o)&&r.options.ignoredFiles.includes(o.name.toLowerCase()))return;if(!hasRoomForItem(r)){if(r.options.allowMultiple||!r.options.allowMultiple&&!r.options.allowReplace){const t=createResponse("warning",0,"Max files");return e("DID_THROW_MAX_FILES",{source:o,error:t}),void a({error:t,file:null})}const c=getActiveItems(r.items)[0];if(c.status===ItemStatus.PROCESSING_COMPLETE||c.status===ItemStatus.PROCESSING_REVERT_ERROR){const d=t("GET_FORCE_REVERT");if(c.revert(createRevertFunction(r.options.server.url,r.options.server.revert),d).then((()=>{d&&e("ADD_ITEM",{source:o,index:i,interactionMethod:n,success:s,failure:a,options:l})})).catch((()=>{})),d)return}e("REMOVE_ITEM",{query:c.id})}const c="local"===l.type?FileOrigin.LOCAL:"limbo"===l.type?FileOrigin.LIMBO:FileOrigin.INPUT,d=createItem(c,c===FileOrigin.INPUT?null:o,l.file);Object.keys(l.metadata||{}).forEach((e=>{d.setMetadata(e,l.metadata[e])})),applyFilters("DID_CREATE_ITEM",d,{query:t,dispatch:e});const p=t("GET_ITEM_INSERT_LOCATION");r.options.itemInsertLocationFreedom||(i="before"===p?-1:r.items.length),insertItem(r.items,d,i),isFunction(p)&&o&&sortItems(r,p);const u=d.id;d.on("init",(()=>{e("DID_INIT_ITEM",{id:u})})),d.on("load-init",(()=>{e("DID_START_ITEM_LOAD",{id:u})})),d.on("load-meta",(()=>{e("DID_UPDATE_ITEM_META",{id:u})})),d.on("load-progress",(t=>{e("DID_UPDATE_ITEM_LOAD_PROGRESS",{id:u,progress:t})})),d.on("load-request-error",(t=>{const o=dynamicLabel(r.options.labelFileLoadError)(t);if(t.code>=400&&t.code<500)return e("DID_THROW_ITEM_INVALID",{id:u,error:t,status:{main:o,sub:`${t.code} (${t.body})`}}),void a({error:t,file:createItemAPI(d)});e("DID_THROW_ITEM_LOAD_ERROR",{id:u,error:t,status:{main:o,sub:r.options.labelTapToRetry}})})),d.on("load-file-error",(t=>{e("DID_THROW_ITEM_INVALID",{id:u,error:t.status,status:t.status}),a({error:t.status,file:createItemAPI(d)})})),d.on("load-abort",(()=>{e("REMOVE_ITEM",{query:u})})),d.on("load-skip",(()=>{e("COMPLETE_LOAD_ITEM",{query:u,item:d,data:{source:o,success:s}})})),d.on("load",(()=>{const i=i=>{i?(d.on("metadata-update",(t=>{e("DID_UPDATE_ITEM_METADATA",{id:u,change:t})})),applyFilterChain("SHOULD_PREPARE_OUTPUT",!1,{item:d,query:t}).then((i=>{const n=t("GET_BEFORE_PREPARE_FILE");n&&(i=n(d,i));const a=()=>{e("COMPLETE_LOAD_ITEM",{query:u,item:d,data:{source:o,success:s}}),listUpdated(e,r)};i?e("REQUEST_PREPARE_OUTPUT",{query:u,item:d,success:t=>{e("DID_PREPARE_OUTPUT",{id:u,file:t}),a()}},!0):a()}))):e("REMOVE_ITEM",{query:u})};applyFilterChain("DID_LOAD_ITEM",d,{query:t,dispatch:e}).then((()=>{optionalPromise(t("GET_BEFORE_ADD_FILE"),createItemAPI(d)).then(i)})).catch((t=>{if(!t||!t.error||!t.status)return i(!1);e("DID_THROW_ITEM_INVALID",{id:u,error:t.error,status:t.status})}))})),d.on("process-start",(()=>{e("DID_START_ITEM_PROCESSING",{id:u})})),d.on("process-progress",(t=>{e("DID_UPDATE_ITEM_PROCESS_PROGRESS",{id:u,progress:t})})),d.on("process-error",(t=>{e("DID_THROW_ITEM_PROCESSING_ERROR",{id:u,error:t,status:{main:dynamicLabel(r.options.labelFileProcessingError)(t),sub:r.options.labelTapToRetry}})})),d.on("process-revert-error",(t=>{e("DID_THROW_ITEM_PROCESSING_REVERT_ERROR",{id:u,error:t,status:{main:dynamicLabel(r.options.labelFileProcessingRevertError)(t),sub:r.options.labelTapToRetry}})})),d.on("process-complete",(t=>{e("DID_COMPLETE_ITEM_PROCESSING",{id:u,error:null,serverFileReference:t}),e("DID_DEFINE_VALUE",{id:u,value:t})})),d.on("process-abort",(()=>{e("DID_ABORT_ITEM_PROCESSING",{id:u})})),d.on("process-revert",(()=>{e("DID_REVERT_ITEM_PROCESSING",{id:u}),e("DID_DEFINE_VALUE",{id:u,value:null})})),e("DID_ADD_ITEM",{id:u,index:i,interactionMethod:n}),listUpdated(e,r);const{url:E,load:m,restore:I,fetch:T}=r.options.server||{};d.load(o,createFileLoader(c===FileOrigin.INPUT?isString(o)&&isExternalURL(o)&&T?createFetchFunction(E,T):fetchBlob:createFetchFunction(E,c===FileOrigin.LIMBO?I:m)),((e,r,o)=>{applyFilterChain("LOAD_FILE",e,{query:t}).then(r).catch(o)}))},REQUEST_PREPARE_OUTPUT:({item:e,success:r,failure:o=(()=>{})})=>{const i={error:createResponse("error",0,"Item not found"),file:null};if(e.archived)return o(i);applyFilterChain("PREPARE_OUTPUT",e.file,{query:t,item:e}).then((n=>{applyFilterChain("COMPLETE_PREPARE_OUTPUT",n,{query:t,item:e}).then((t=>{if(e.archived)return o(i);r(t)}))}))},COMPLETE_LOAD_ITEM:({item:o,data:i})=>{const{success:n,source:s}=i,a=t("GET_ITEM_INSERT_LOCATION");if(isFunction(a)&&s&&sortItems(r,a),e("DID_LOAD_ITEM",{id:o.id,error:null,serverFileReference:o.origin===FileOrigin.INPUT?null:s}),n(createItemAPI(o)),o.origin!==FileOrigin.LOCAL)return o.origin===FileOrigin.LIMBO?(e("DID_COMPLETE_ITEM_PROCESSING",{id:o.id,error:null,serverFileReference:s}),void e("DID_DEFINE_VALUE",{id:o.id,value:o.serverId||s})):void(t("IS_ASYNC")&&r.options.instantUpload&&e("REQUEST_ITEM_PROCESSING",{query:o.id}));e("DID_LOAD_LOCAL_ITEM",{id:o.id})},RETRY_ITEM_LOAD:getItemByQueryFromState(r,(e=>{e.retryLoad()})),REQUEST_ITEM_PREPARE:getItemByQueryFromState(r,((t,r,o)=>{e("REQUEST_PREPARE_OUTPUT",{query:t.id,item:t,success:o=>{e("DID_PREPARE_OUTPUT",{id:t.id,file:o}),r({file:t,output:o})},failure:o},!0)})),REQUEST_ITEM_PROCESSING:getItemByQueryFromState(r,((o,i,n)=>{if(o.status===ItemStatus.IDLE||o.status===ItemStatus.PROCESSING_ERROR)o.status!==ItemStatus.PROCESSING_QUEUED&&(o.requestProcessing(),e("DID_REQUEST_ITEM_PROCESSING",{id:o.id}),e("PROCESS_ITEM",{query:o,success:i,failure:n},!0));else{const s=()=>e("REQUEST_ITEM_PROCESSING",{query:o,success:i,failure:n}),a=()=>document.hidden?s():setTimeout(s,32);o.status===ItemStatus.PROCESSING_COMPLETE||o.status===ItemStatus.PROCESSING_REVERT_ERROR?o.revert(createRevertFunction(r.options.server.url,r.options.server.revert),t("GET_FORCE_REVERT")).then(a).catch((()=>{})):o.status===ItemStatus.PROCESSING&&o.abortProcessing().then(a)}})),PROCESS_ITEM:getItemByQueryFromState(r,((o,i,n)=>{const s=t("GET_MAX_PARALLEL_UPLOADS");if(t("GET_ITEMS_BY_STATUS",ItemStatus.PROCESSING).length===s)return void r.processingQueue.push({id:o.id,success:i,failure:n});if(o.status===ItemStatus.PROCESSING)return;const a=()=>{const t=r.processingQueue.shift();if(!t)return;const{id:o,success:i,failure:n}=t,s=getItemByQuery(r.items,o);s&&!s.archived?e("PROCESS_ITEM",{query:o,success:i,failure:n},!0):a()};o.onOnce("process-complete",(()=>{i(createItemAPI(o)),a();const n=r.options.server;if(r.options.instantUpload&&o.origin===FileOrigin.LOCAL&&isFunction(n.remove)){const e=()=>{};o.origin=FileOrigin.LIMBO,r.options.server.remove(o.source,e,e)}t("GET_ITEMS_BY_STATUS",ItemStatus.PROCESSING_COMPLETE).length===r.items.length&&e("DID_COMPLETE_ITEM_PROCESSING_ALL")})),o.onOnce("process-error",(e=>{n({error:e,file:createItemAPI(o)}),a()}));const l=r.options;o.process(createFileProcessor(createProcessorFunction(l.server.url,l.server.process,l.name,{chunkTransferId:o.transferId,chunkServer:l.server.patch,chunkUploads:l.chunkUploads,chunkForce:l.chunkForce,chunkSize:l.chunkSize,chunkRetryDelays:l.chunkRetryDelays}),{allowMinimumUploadDuration:t("GET_ALLOW_MINIMUM_UPLOAD_DURATION")}),((r,i,n)=>{applyFilterChain("PREPARE_OUTPUT",r,{query:t,item:o}).then((t=>{e("DID_PREPARE_OUTPUT",{id:o.id,file:t}),i(t)})).catch(n)}))})),RETRY_ITEM_PROCESSING:getItemByQueryFromState(r,(t=>{e("REQUEST_ITEM_PROCESSING",{query:t})})),REQUEST_REMOVE_ITEM:getItemByQueryFromState(r,(r=>{optionalPromise(t("GET_BEFORE_REMOVE_FILE"),createItemAPI(r)).then((t=>{t&&e("REMOVE_ITEM",{query:r})}))})),RELEASE_ITEM:getItemByQueryFromState(r,(e=>{e.release()})),REMOVE_ITEM:getItemByQueryFromState(r,((o,i,n,s)=>{const a=()=>{const t=o.id;getItemById(r.items,t).archive(),e("DID_REMOVE_ITEM",{error:null,id:t,item:o}),listUpdated(e,r),i(createItemAPI(o))},l=r.options.server;o.origin===FileOrigin.LOCAL&&l&&isFunction(l.remove)&&!1!==s.remove?(e("DID_START_ITEM_REMOVE",{id:o.id}),l.remove(o.source,(()=>a()),(t=>{e("DID_THROW_ITEM_REMOVE_ERROR",{id:o.id,error:createResponse("error",0,t,null),status:{main:dynamicLabel(r.options.labelFileRemoveError)(t),sub:r.options.labelTapToRetry}})}))):((s.revert&&o.origin!==FileOrigin.LOCAL&&null!==o.serverId||r.options.chunkUploads&&o.file.size>r.options.chunkSize||r.options.chunkUploads&&r.options.chunkForce)&&o.revert(createRevertFunction(r.options.server.url,r.options.server.revert),t("GET_FORCE_REVERT")),a())})),ABORT_ITEM_LOAD:getItemByQueryFromState(r,(e=>{e.abortLoad()})),ABORT_ITEM_PROCESSING:getItemByQueryFromState(r,(t=>{t.serverId?e("REVERT_ITEM_PROCESSING",{id:t.id}):t.abortProcessing().then((()=>{r.options.instantUpload&&e("REMOVE_ITEM",{query:t.id})}))})),REQUEST_REVERT_ITEM_PROCESSING:getItemByQueryFromState(r,(o=>{if(!r.options.instantUpload)return void e("REVERT_ITEM_PROCESSING",{query:o});const i=t=>{t&&e("REVERT_ITEM_PROCESSING",{query:o})},n=t("GET_BEFORE_REMOVE_FILE");if(!n)return i(!0);const s=n(createItemAPI(o));return null==s?i(!0):"boolean"==typeof s?i(s):void("function"==typeof s.then&&s.then(i))})),REVERT_ITEM_PROCESSING:getItemByQueryFromState(r,(o=>{o.revert(createRevertFunction(r.options.server.url,r.options.server.revert),t("GET_FORCE_REVERT")).then((()=>{(r.options.instantUpload||isMockItem(o))&&e("REMOVE_ITEM",{query:o.id})})).catch((()=>{}))})),SET_OPTIONS:({options:t})=>{const r=Object.keys(t),o=PrioritizedOptions.filter((e=>r.includes(e)));[...o,...Object.keys(t).filter((e=>!o.includes(e)))].forEach((r=>{e(`SET_${fromCamels(r,"_").toUpperCase()}`,{value:t[r]})}))}}),PrioritizedOptions=["server"],formatFilename=e=>e,createElement$1=e=>document.createElement(e),text=(e,t)=>{let r=e.childNodes[0];r?t!==r.nodeValue&&(r.nodeValue=t):(r=document.createTextNode(t),e.appendChild(r))},polarToCartesian=(e,t,r,o)=>{const i=(o%360-90)*Math.PI/180;return{x:e+r*Math.cos(i),y:t+r*Math.sin(i)}},describeArc=(e,t,r,o,i,n)=>{const s=polarToCartesian(e,t,r,i),a=polarToCartesian(e,t,r,o);return["M",s.x,s.y,"A",r,r,0,n,0,a.x,a.y].join(" ")},percentageArc=(e,t,r,o,i)=>{let n=1;return i>o&&i-o<=.5&&(n=0),o>i&&o-i>=.5&&(n=0),describeArc(e,t,r,360*Math.min(.9999,o),360*Math.min(.9999,i),n)},create=({root:e,props:t})=>{t.spin=!1,t.progress=0,t.opacity=0;const r=createElement("svg");e.ref.path=createElement("path",{"stroke-width":2,"stroke-linecap":"round"}),r.appendChild(e.ref.path),e.ref.svg=r,e.appendChild(r)},write=({root:e,props:t})=>{if(0===t.opacity)return;t.align&&(e.element.dataset.align=t.align);const r=parseInt(attr(e.ref.path,"stroke-width"),10),o=.5*e.rect.element.width;let i=0,n=0;t.spin?(i=0,n=.5):(i=0,n=t.progress);const s=percentageArc(o,o,o-r,i,n);attr(e.ref.path,"d",s),attr(e.ref.path,"stroke-opacity",t.spin||t.progress>0?1:0)},progressIndicator=createView({tag:"div",name:"progress-indicator",ignoreRectUpdate:!0,ignoreRect:!0,create:create,write:write,mixins:{apis:["progress","spin","align"],styles:["opacity"],animations:{opacity:{type:"tween",duration:500},progress:{type:"spring",stiffness:.95,damping:.65,mass:10}}}}),create$1=({root:e,props:t})=>{e.element.innerHTML=(t.icon||"")+`<span>${t.label}</span>`,t.isDisabled=!1},write$1=({root:e,props:t})=>{const{isDisabled:r}=t,o=e.query("GET_DISABLED")||0===t.opacity;o&&!r?(t.isDisabled=!0,attr(e.element,"disabled","disabled")):!o&&r&&(t.isDisabled=!1,e.element.removeAttribute("disabled"))},fileActionButton=createView({tag:"button",attributes:{type:"button"},ignoreRect:!0,ignoreRectUpdate:!0,name:"file-action-button",mixins:{apis:["label"],styles:["translateX","translateY","scaleX","scaleY","opacity"],animations:{scaleX:"spring",scaleY:"spring",translateX:"spring",translateY:"spring",opacity:{type:"tween",duration:250}},listeners:!0},create:create$1,write:write$1}),toNaturalFileSize=(e,t=".",r=1e3,o={})=>{const{labelBytes:i="bytes",labelKilobytes:n="KB",labelMegabytes:s="MB",labelGigabytes:a="GB"}=o,l=r,c=r*r,d=r*r*r;return(e=Math.round(Math.abs(e)))<l?`${e} ${i}`:e<c?`${Math.floor(e/l)} ${n}`:e<d?`${removeDecimalsWhenZero(e/c,1,t)} ${s}`:`${removeDecimalsWhenZero(e/d,2,t)} ${a}`},removeDecimalsWhenZero=(e,t,r)=>e.toFixed(t).split(".").filter((e=>"0"!==e)).join(r),create$2=({root:e,props:t})=>{const r=createElement$1("span");r.className="filepond--file-info-main",attr(r,"aria-hidden","true"),e.appendChild(r),e.ref.fileName=r;const o=createElement$1("span");o.className="filepond--file-info-sub",e.appendChild(o),e.ref.fileSize=o,text(o,e.query("GET_LABEL_FILE_WAITING_FOR_SIZE")),text(r,e.query("GET_ITEM_NAME",t.id))},updateFile=({root:e,props:t})=>{text(e.ref.fileSize,toNaturalFileSize(e.query("GET_ITEM_SIZE",t.id),".",e.query("GET_FILE_SIZE_BASE"),e.query("GET_FILE_SIZE_LABELS",e.query))),text(e.ref.fileName,e.query("GET_ITEM_NAME",t.id))},updateFileSizeOnError=({root:e,props:t})=>{isInt(e.query("GET_ITEM_SIZE",t.id))?updateFile({root:e,props:t}):text(e.ref.fileSize,e.query("GET_LABEL_FILE_SIZE_NOT_AVAILABLE"))},fileInfo=createView({name:"file-info",ignoreRect:!0,ignoreRectUpdate:!0,write:createRoute({DID_LOAD_ITEM:updateFile,DID_UPDATE_ITEM_META:updateFile,DID_THROW_ITEM_LOAD_ERROR:updateFileSizeOnError,DID_THROW_ITEM_INVALID:updateFileSizeOnError}),didCreateView:e=>{applyFilters("CREATE_VIEW",{...e,view:e})},create:create$2,mixins:{styles:["translateX","translateY"],animations:{translateX:"spring",translateY:"spring"}}}),toPercentage=e=>Math.round(100*e),create$3=({root:e})=>{const t=createElement$1("span");t.className="filepond--file-status-main",e.appendChild(t),e.ref.main=t;const r=createElement$1("span");r.className="filepond--file-status-sub",e.appendChild(r),e.ref.sub=r,didSetItemLoadProgress({root:e,action:{progress:null}})},didSetItemLoadProgress=({root:e,action:t})=>{const r=null===t.progress?e.query("GET_LABEL_FILE_LOADING"):`${e.query("GET_LABEL_FILE_LOADING")} ${toPercentage(t.progress)}%`;text(e.ref.main,r),text(e.ref.sub,e.query("GET_LABEL_TAP_TO_CANCEL"))},didSetItemProcessProgress=({root:e,action:t})=>{const r=null===t.progress?e.query("GET_LABEL_FILE_PROCESSING"):`${e.query("GET_LABEL_FILE_PROCESSING")} ${toPercentage(t.progress)}%`;text(e.ref.main,r),text(e.ref.sub,e.query("GET_LABEL_TAP_TO_CANCEL"))},didRequestItemProcessing=({root:e})=>{text(e.ref.main,e.query("GET_LABEL_FILE_PROCESSING")),text(e.ref.sub,e.query("GET_LABEL_TAP_TO_CANCEL"))},didAbortItemProcessing=({root:e})=>{text(e.ref.main,e.query("GET_LABEL_FILE_PROCESSING_ABORTED")),text(e.ref.sub,e.query("GET_LABEL_TAP_TO_RETRY"))},didCompleteItemProcessing=({root:e})=>{text(e.ref.main,e.query("GET_LABEL_FILE_PROCESSING_COMPLETE")),text(e.ref.sub,e.query("GET_LABEL_TAP_TO_UNDO"))},clear=({root:e})=>{text(e.ref.main,""),text(e.ref.sub,"")},error=({root:e,action:t})=>{text(e.ref.main,t.status.main),text(e.ref.sub,t.status.sub)},fileStatus=createView({name:"file-status",ignoreRect:!0,ignoreRectUpdate:!0,write:createRoute({DID_LOAD_ITEM:clear,DID_REVERT_ITEM_PROCESSING:clear,DID_REQUEST_ITEM_PROCESSING:didRequestItemProcessing,DID_ABORT_ITEM_PROCESSING:didAbortItemProcessing,DID_COMPLETE_ITEM_PROCESSING:didCompleteItemProcessing,DID_UPDATE_ITEM_PROCESS_PROGRESS:didSetItemProcessProgress,DID_UPDATE_ITEM_LOAD_PROGRESS:didSetItemLoadProgress,DID_THROW_ITEM_LOAD_ERROR:error,DID_THROW_ITEM_INVALID:error,DID_THROW_ITEM_PROCESSING_ERROR:error,DID_THROW_ITEM_PROCESSING_REVERT_ERROR:error,DID_THROW_ITEM_REMOVE_ERROR:error}),didCreateView:e=>{applyFilters("CREATE_VIEW",{...e,view:e})},create:create$3,mixins:{styles:["translateX","translateY","opacity"],animations:{opacity:{type:"tween",duration:250},translateX:"spring",translateY:"spring"}}}),Buttons={AbortItemLoad:{label:"GET_LABEL_BUTTON_ABORT_ITEM_LOAD",action:"ABORT_ITEM_LOAD",className:"filepond--action-abort-item-load",align:"LOAD_INDICATOR_POSITION"},RetryItemLoad:{label:"GET_LABEL_BUTTON_RETRY_ITEM_LOAD",action:"RETRY_ITEM_LOAD",icon:"GET_ICON_RETRY",className:"filepond--action-retry-item-load",align:"BUTTON_PROCESS_ITEM_POSITION"},RemoveItem:{label:"GET_LABEL_BUTTON_REMOVE_ITEM",action:"REQUEST_REMOVE_ITEM",icon:"GET_ICON_REMOVE",className:"filepond--action-remove-item",align:"BUTTON_REMOVE_ITEM_POSITION"},ProcessItem:{label:"GET_LABEL_BUTTON_PROCESS_ITEM",action:"REQUEST_ITEM_PROCESSING",icon:"GET_ICON_PROCESS",className:"filepond--action-process-item",align:"BUTTON_PROCESS_ITEM_POSITION"},AbortItemProcessing:{label:"GET_LABEL_BUTTON_ABORT_ITEM_PROCESSING",action:"ABORT_ITEM_PROCESSING",className:"filepond--action-abort-item-processing",align:"BUTTON_PROCESS_ITEM_POSITION"},RetryItemProcessing:{label:"GET_LABEL_BUTTON_RETRY_ITEM_PROCESSING",action:"RETRY_ITEM_PROCESSING",icon:"GET_ICON_RETRY",className:"filepond--action-retry-item-processing",align:"BUTTON_PROCESS_ITEM_POSITION"},RevertItemProcessing:{label:"GET_LABEL_BUTTON_UNDO_ITEM_PROCESSING",action:"REQUEST_REVERT_ITEM_PROCESSING",icon:"GET_ICON_UNDO",className:"filepond--action-revert-item-processing",align:"BUTTON_PROCESS_ITEM_POSITION"}},ButtonKeys=[];forin(Buttons,(e=>{ButtonKeys.push(e)}));const calculateFileInfoOffset=e=>{if("right"===getRemoveIndicatorAligment(e))return 0;const t=e.ref.buttonRemoveItem.rect.element;return t.hidden?null:t.width+t.left},calculateButtonWidth=e=>e.ref.buttonAbortItemLoad.rect.element.width,calculateFileVerticalCenterOffset=e=>Math.floor(e.ref.buttonRemoveItem.rect.element.height/4),calculateFileHorizontalCenterOffset=e=>Math.floor(e.ref.buttonRemoveItem.rect.element.left/2),getLoadIndicatorAlignment=e=>e.query("GET_STYLE_LOAD_INDICATOR_POSITION"),getProcessIndicatorAlignment=e=>e.query("GET_STYLE_PROGRESS_INDICATOR_POSITION"),getRemoveIndicatorAligment=e=>e.query("GET_STYLE_BUTTON_REMOVE_ITEM_POSITION"),DefaultStyle={buttonAbortItemLoad:{opacity:0},buttonRetryItemLoad:{opacity:0},buttonRemoveItem:{opacity:0},buttonProcessItem:{opacity:0},buttonAbortItemProcessing:{opacity:0},buttonRetryItemProcessing:{opacity:0},buttonRevertItemProcessing:{opacity:0},loadProgressIndicator:{opacity:0,align:getLoadIndicatorAlignment},processProgressIndicator:{opacity:0,align:getProcessIndicatorAlignment},processingCompleteIndicator:{opacity:0,scaleX:.75,scaleY:.75},info:{translateX:0,translateY:0,opacity:0},status:{translateX:0,translateY:0,opacity:0}},IdleStyle={buttonRemoveItem:{opacity:1},buttonProcessItem:{opacity:1},info:{translateX:calculateFileInfoOffset},status:{translateX:calculateFileInfoOffset}},ProcessingStyle={buttonAbortItemProcessing:{opacity:1},processProgressIndicator:{opacity:1},status:{opacity:1}},StyleMap={DID_THROW_ITEM_INVALID:{buttonRemoveItem:{opacity:1},info:{translateX:calculateFileInfoOffset},status:{translateX:calculateFileInfoOffset,opacity:1}},DID_START_ITEM_LOAD:{buttonAbortItemLoad:{opacity:1},loadProgressIndicator:{opacity:1},status:{opacity:1}},DID_THROW_ITEM_LOAD_ERROR:{buttonRetryItemLoad:{opacity:1},buttonRemoveItem:{opacity:1},info:{translateX:calculateFileInfoOffset},status:{opacity:1}},DID_START_ITEM_REMOVE:{processProgressIndicator:{opacity:1,align:getRemoveIndicatorAligment},info:{translateX:calculateFileInfoOffset},status:{opacity:0}},DID_THROW_ITEM_REMOVE_ERROR:{processProgressIndicator:{opacity:0,align:getRemoveIndicatorAligment},buttonRemoveItem:{opacity:1},info:{translateX:calculateFileInfoOffset},status:{opacity:1,translateX:calculateFileInfoOffset}},DID_LOAD_ITEM:IdleStyle,DID_LOAD_LOCAL_ITEM:{buttonRemoveItem:{opacity:1},info:{translateX:calculateFileInfoOffset},status:{translateX:calculateFileInfoOffset}},DID_START_ITEM_PROCESSING:ProcessingStyle,DID_REQUEST_ITEM_PROCESSING:ProcessingStyle,DID_UPDATE_ITEM_PROCESS_PROGRESS:ProcessingStyle,DID_COMPLETE_ITEM_PROCESSING:{buttonRevertItemProcessing:{opacity:1},info:{opacity:1},status:{opacity:1}},DID_THROW_ITEM_PROCESSING_ERROR:{buttonRemoveItem:{opacity:1},buttonRetryItemProcessing:{opacity:1},status:{opacity:1},info:{translateX:calculateFileInfoOffset}},DID_THROW_ITEM_PROCESSING_REVERT_ERROR:{buttonRevertItemProcessing:{opacity:1},status:{opacity:1},info:{opacity:1}},DID_ABORT_ITEM_PROCESSING:{buttonRemoveItem:{opacity:1},buttonProcessItem:{opacity:1},info:{translateX:calculateFileInfoOffset},status:{opacity:1}},DID_REVERT_ITEM_PROCESSING:IdleStyle},processingCompleteIndicatorView=createView({create:({root:e})=>{e.element.innerHTML=e.query("GET_ICON_DONE")},name:"processing-complete-indicator",ignoreRect:!0,mixins:{styles:["scaleX","scaleY","opacity"],animations:{scaleX:"spring",scaleY:"spring",opacity:{type:"tween",duration:250}}}}),create$4=({root:e,props:t})=>{const r=Object.keys(Buttons).reduce(((e,t)=>(e[t]={...Buttons[t]},e)),{}),{id:o}=t,i=e.query("GET_ALLOW_REVERT"),n=e.query("GET_ALLOW_REMOVE"),s=e.query("GET_ALLOW_PROCESS"),a=e.query("GET_INSTANT_UPLOAD"),l=e.query("IS_ASYNC"),c=e.query("GET_STYLE_BUTTON_REMOVE_ITEM_ALIGN");let d;l?s&&!i?d=e=>!/RevertItemProcessing/.test(e):!s&&i?d=e=>!/ProcessItem|RetryItemProcessing|AbortItemProcessing/.test(e):s||i||(d=e=>!/Process/.test(e)):d=e=>!/Process/.test(e);const p=d?ButtonKeys.filter(d):ButtonKeys.concat();if(a&&i&&(r.RevertItemProcessing.label="GET_LABEL_BUTTON_REMOVE_ITEM",r.RevertItemProcessing.icon="GET_ICON_REMOVE"),l&&!i){const e=StyleMap.DID_COMPLETE_ITEM_PROCESSING;e.info.translateX=calculateFileHorizontalCenterOffset,e.info.translateY=calculateFileVerticalCenterOffset,e.status.translateY=calculateFileVerticalCenterOffset,e.processingCompleteIndicator={opacity:1,scaleX:1,scaleY:1}}if(l&&!s&&(["DID_START_ITEM_PROCESSING","DID_REQUEST_ITEM_PROCESSING","DID_UPDATE_ITEM_PROCESS_PROGRESS","DID_THROW_ITEM_PROCESSING_ERROR"].forEach((e=>{StyleMap[e].status.translateY=calculateFileVerticalCenterOffset})),StyleMap.DID_THROW_ITEM_PROCESSING_ERROR.status.translateX=calculateButtonWidth),c&&i){r.RevertItemProcessing.align="BUTTON_REMOVE_ITEM_POSITION";const e=StyleMap.DID_COMPLETE_ITEM_PROCESSING;e.info.translateX=calculateFileInfoOffset,e.status.translateY=calculateFileVerticalCenterOffset,e.processingCompleteIndicator={opacity:1,scaleX:1,scaleY:1}}n||(r.RemoveItem.disabled=!0),forin(r,((t,r)=>{const i=e.createChildView(fileActionButton,{label:e.query(r.label),icon:e.query(r.icon),opacity:0});p.includes(t)&&e.appendChildView(i),r.disabled&&(i.element.setAttribute("disabled","disabled"),i.element.setAttribute("hidden","hidden")),i.element.dataset.align=e.query(`GET_STYLE_${r.align}`),i.element.classList.add(r.className),i.on("click",(t=>{t.stopPropagation(),r.disabled||e.dispatch(r.action,{query:o})})),e.ref[`button${t}`]=i})),e.ref.processingCompleteIndicator=e.appendChildView(e.createChildView(processingCompleteIndicatorView)),e.ref.processingCompleteIndicator.element.dataset.align=e.query("GET_STYLE_BUTTON_PROCESS_ITEM_POSITION"),e.ref.info=e.appendChildView(e.createChildView(fileInfo,{id:o})),e.ref.status=e.appendChildView(e.createChildView(fileStatus,{id:o}));const u=e.appendChildView(e.createChildView(progressIndicator,{opacity:0,align:e.query("GET_STYLE_LOAD_INDICATOR_POSITION")}));u.element.classList.add("filepond--load-indicator"),e.ref.loadProgressIndicator=u;const E=e.appendChildView(e.createChildView(progressIndicator,{opacity:0,align:e.query("GET_STYLE_PROGRESS_INDICATOR_POSITION")}));E.element.classList.add("filepond--process-indicator"),e.ref.processProgressIndicator=E,e.ref.activeStyles=[]},write$2=({root:e,actions:t,props:r})=>{route({root:e,actions:t,props:r});let o=t.concat().filter((e=>/^DID_/.test(e.type))).reverse().find((e=>StyleMap[e.type]));if(o){e.ref.activeStyles=[];const t=StyleMap[o.type];forin(DefaultStyle,((r,o)=>{const i=e.ref[r];forin(o,((o,n)=>{const s=t[r]&&void 0!==t[r][o]?t[r][o]:n;e.ref.activeStyles.push({control:i,key:o,value:s})}))}))}e.ref.activeStyles.forEach((({control:t,key:r,value:o})=>{t[r]="function"==typeof o?o(e):o}))},route=createRoute({DID_SET_LABEL_BUTTON_ABORT_ITEM_PROCESSING:({root:e,action:t})=>{e.ref.buttonAbortItemProcessing.label=t.value},DID_SET_LABEL_BUTTON_ABORT_ITEM_LOAD:({root:e,action:t})=>{e.ref.buttonAbortItemLoad.label=t.value},DID_SET_LABEL_BUTTON_ABORT_ITEM_REMOVAL:({root:e,action:t})=>{e.ref.buttonAbortItemRemoval.label=t.value},DID_REQUEST_ITEM_PROCESSING:({root:e})=>{e.ref.processProgressIndicator.spin=!0,e.ref.processProgressIndicator.progress=0},DID_START_ITEM_LOAD:({root:e})=>{e.ref.loadProgressIndicator.spin=!0,e.ref.loadProgressIndicator.progress=0},DID_START_ITEM_REMOVE:({root:e})=>{e.ref.processProgressIndicator.spin=!0,e.ref.processProgressIndicator.progress=0},DID_UPDATE_ITEM_LOAD_PROGRESS:({root:e,action:t})=>{e.ref.loadProgressIndicator.spin=!1,e.ref.loadProgressIndicator.progress=t.progress},DID_UPDATE_ITEM_PROCESS_PROGRESS:({root:e,action:t})=>{e.ref.processProgressIndicator.spin=!1,e.ref.processProgressIndicator.progress=t.progress}}),file=createView({create:create$4,write:write$2,didCreateView:e=>{applyFilters("CREATE_VIEW",{...e,view:e})},name:"file"}),create$5=({root:e,props:t})=>{e.ref.fileName=createElement$1("legend"),e.appendChild(e.ref.fileName),e.ref.file=e.appendChildView(e.createChildView(file,{id:t.id})),e.ref.data=!1},didLoadItem=({root:e,props:t})=>{text(e.ref.fileName,e.query("GET_ITEM_NAME",t.id))},fileWrapper=createView({create:create$5,ignoreRect:!0,write:createRoute({DID_LOAD_ITEM:didLoadItem}),didCreateView:e=>{applyFilters("CREATE_VIEW",{...e,view:e})},tag:"fieldset",name:"file-wrapper"}),PANEL_SPRING_PROPS={type:"spring",damping:.6,mass:7},create$6=({root:e,props:t})=>{[{name:"top"},{name:"center",props:{translateY:null,scaleY:null},mixins:{animations:{scaleY:PANEL_SPRING_PROPS},styles:["translateY","scaleY"]}},{name:"bottom",props:{translateY:null},mixins:{animations:{translateY:PANEL_SPRING_PROPS},styles:["translateY"]}}].forEach((r=>{createSection(e,r,t.name)})),e.element.classList.add(`filepond--${t.name}`),e.ref.scalable=null},createSection=(e,t,r)=>{const o=createView({name:`panel-${t.name} filepond--${r}`,mixins:t.mixins,ignoreRectUpdate:!0}),i=e.createChildView(o,t.props);e.ref[t.name]=e.appendChildView(i)},write$3=({root:e,props:t})=>{if(null!==e.ref.scalable&&t.scalable===e.ref.scalable||(e.ref.scalable=!isBoolean(t.scalable)||t.scalable,e.element.dataset.scalable=e.ref.scalable),!t.height)return;const r=e.ref.top.rect.element,o=e.ref.bottom.rect.element,i=Math.max(r.height+o.height,t.height);e.ref.center.translateY=r.height,e.ref.center.scaleY=(i-r.height-o.height)/100,e.ref.bottom.translateY=i-o.height},panel=createView({name:"panel",read:({root:e,props:t})=>t.heightCurrent=e.ref.bottom.translateY,write:write$3,create:create$6,ignoreRect:!0,mixins:{apis:["height","heightCurrent","scalable"]}}),createDragHelper=e=>{const t=e.map((e=>e.id));let r;return{setIndex:e=>{r=e},getIndex:()=>r,getItemIndex:e=>t.indexOf(e.id)}},ITEM_TRANSLATE_SPRING={type:"spring",stiffness:.75,damping:.45,mass:10},ITEM_SCALE_SPRING="spring",StateMap={DID_START_ITEM_LOAD:"busy",DID_UPDATE_ITEM_LOAD_PROGRESS:"loading",DID_THROW_ITEM_INVALID:"load-invalid",DID_THROW_ITEM_LOAD_ERROR:"load-error",DID_LOAD_ITEM:"idle",DID_THROW_ITEM_REMOVE_ERROR:"remove-error",DID_START_ITEM_REMOVE:"busy",DID_START_ITEM_PROCESSING:"busy processing",DID_REQUEST_ITEM_PROCESSING:"busy processing",DID_UPDATE_ITEM_PROCESS_PROGRESS:"processing",DID_COMPLETE_ITEM_PROCESSING:"processing-complete",DID_THROW_ITEM_PROCESSING_ERROR:"processing-error",DID_THROW_ITEM_PROCESSING_REVERT_ERROR:"processing-revert-error",DID_ABORT_ITEM_PROCESSING:"cancelled",DID_REVERT_ITEM_PROCESSING:"idle"},create$7=({root:e,props:t})=>{if(e.ref.handleClick=r=>e.dispatch("DID_ACTIVATE_ITEM",{id:t.id}),e.element.id=`filepond--item-${t.id}`,e.element.addEventListener("click",e.ref.handleClick),e.ref.container=e.appendChildView(e.createChildView(fileWrapper,{id:t.id})),e.ref.panel=e.appendChildView(e.createChildView(panel,{name:"item-panel"})),e.ref.panel.height=null,t.markedForRemoval=!1,!e.query("GET_ALLOW_REORDER"))return;e.element.dataset.dragState="idle";e.element.addEventListener("pointerdown",(r=>{if(!r.isPrimary)return;let o=!1;const i=r.pageX,n=r.pageY;t.dragOrigin={x:e.translateX,y:e.translateY},t.dragCenter={x:r.offsetX,y:r.offsetY};const s=createDragHelper(e.query("GET_ACTIVE_ITEMS"));e.dispatch("DID_GRAB_ITEM",{id:t.id,dragState:s});const a=r=>{if(!r.isPrimary)return;r.stopPropagation(),r.preventDefault(),t.dragOffset={x:r.pageX-i,y:r.pageY-n};t.dragOffset.x*t.dragOffset.x+t.dragOffset.y*t.dragOffset.y>16&&!o&&(o=!0,e.element.removeEventListener("click",e.ref.handleClick)),e.dispatch("DID_DRAG_ITEM",{id:t.id,dragState:s})},l=r=>{r.isPrimary&&(document.removeEventListener("pointermove",a),document.removeEventListener("pointerup",l),t.dragOffset={x:r.pageX-i,y:r.pageY-n},e.dispatch("DID_DROP_ITEM",{id:t.id,dragState:s}),o&&setTimeout((()=>e.element.addEventListener("click",e.ref.handleClick)),0))};document.addEventListener("pointermove",a),document.addEventListener("pointerup",l)}))},route$1=createRoute({DID_UPDATE_PANEL_HEIGHT:({root:e,action:t})=>{e.height=t.height}}),write$4=createRoute({DID_GRAB_ITEM:({root:e,props:t})=>{t.dragOrigin={x:e.translateX,y:e.translateY}},DID_DRAG_ITEM:({root:e})=>{e.element.dataset.dragState="drag"},DID_DROP_ITEM:({root:e,props:t})=>{t.dragOffset=null,t.dragOrigin=null,e.element.dataset.dragState="drop"}},(({root:e,actions:t,props:r,shouldOptimize:o})=>{"drop"===e.element.dataset.dragState&&e.scaleX<=1&&(e.element.dataset.dragState="idle");let i=t.concat().filter((e=>/^DID_/.test(e.type))).reverse().find((e=>StateMap[e.type]));i&&i.type!==r.currentState&&(r.currentState=i.type,e.element.dataset.filepondItemState=StateMap[r.currentState]||"");const n=e.query("GET_ITEM_PANEL_ASPECT_RATIO")||e.query("GET_PANEL_ASPECT_RATIO");n?o||(e.height=e.rect.element.width*n):(route$1({root:e,actions:t,props:r}),!e.height&&e.ref.container.rect.element.height>0&&(e.height=e.ref.container.rect.element.height)),o&&(e.ref.panel.height=null),e.ref.panel.height=e.height})),item=createView({create:create$7,write:write$4,destroy:({root:e,props:t})=>{e.element.removeEventListener("click",e.ref.handleClick),e.dispatch("RELEASE_ITEM",{query:t.id})},tag:"li",name:"item",mixins:{apis:["id","interactionMethod","markedForRemoval","spawnDate","dragCenter","dragOrigin","dragOffset"],styles:["translateX","translateY","scaleX","scaleY","opacity","height"],animations:{scaleX:"spring",scaleY:"spring",translateX:ITEM_TRANSLATE_SPRING,translateY:ITEM_TRANSLATE_SPRING,opacity:{type:"tween",duration:150}}}});var getItemsPerRow=(e,t)=>Math.max(1,Math.floor((e+1)/t));const getItemIndexByPosition=(e,t,r)=>{if(!r)return;const o=e.rect.element.width,i=t.length;let n=null;if(0===i||r.top<t[0].rect.element.top)return-1;const s=t[0].rect.element,a=s.marginLeft+s.marginRight,l=s.width+a,c=getItemsPerRow(o,l);if(1===c){for(let e=0;e<i;e++){const o=t[e],i=o.rect.outer.top+.5*o.rect.element.height;if(r.top<i)return e}return i}const d=s.marginTop+s.marginBottom,p=s.height+d;for(let e=0;e<i;e++){const t=e%c*l,o=Math.floor(e/c)*p,a=o-s.marginTop,d=t+l,u=o+p+s.marginBottom;if(r.top<u&&r.top>a){if(r.left<d)return e;n=e!==i-1?e:null}}return null!==n?n:i},dropAreaDimensions={height:0,width:0,get getHeight(){return this.height},set setHeight(e){0!==this.height&&0!==e||(this.height=e)},get getWidth(){return this.width},set setWidth(e){0!==this.width&&0!==e||(this.width=e)},setDimensions:function(e,t){0!==this.height&&0!==e||(this.height=e),0!==this.width&&0!==t||(this.width=t)}},create$8=({root:e})=>{attr(e.element,"role","list"),e.ref.lastItemSpanwDate=Date.now()},addItemView=({root:e,action:t})=>{const{id:r,index:o,interactionMethod:i}=t;e.ref.addIndex=o;const n=Date.now();let s=n,a=1;if(i!==InteractionMethod.NONE){a=0;const t=e.query("GET_ITEM_INSERT_INTERVAL"),r=n-e.ref.lastItemSpanwDate;s=r<t?n+(t-r):n}e.ref.lastItemSpanwDate=s,e.appendChildView(e.createChildView(item,{spawnDate:s,id:r,opacity:a,interactionMethod:i}),o)},moveItem=(e,t,r,o=0,i=1)=>{e.dragOffset?(e.translateX=null,e.translateY=null,e.translateX=e.dragOrigin.x+e.dragOffset.x,e.translateY=e.dragOrigin.y+e.dragOffset.y,e.scaleX=1.025,e.scaleY=1.025):(e.translateX=t,e.translateY=r,Date.now()>e.spawnDate&&(0===e.opacity&&introItemView(e,t,r,o,i),e.scaleX=1,e.scaleY=1,e.opacity=1))},introItemView=(e,t,r,o,i)=>{e.interactionMethod===InteractionMethod.NONE?(e.translateX=null,e.translateX=t,e.translateY=null,e.translateY=r):e.interactionMethod===InteractionMethod.DROP?(e.translateX=null,e.translateX=t-20*o,e.translateY=null,e.translateY=r-10*i,e.scaleX=.8,e.scaleY=.8):e.interactionMethod===InteractionMethod.BROWSE?(e.translateY=null,e.translateY=r-30):e.interactionMethod===InteractionMethod.API&&(e.translateX=null,e.translateX=t-30,e.translateY=null)},removeItemView=({root:e,action:t})=>{const{id:r}=t,o=e.childViews.find((e=>e.id===r));o&&(o.scaleX=.9,o.scaleY=.9,o.opacity=0,o.markedForRemoval=!0)},getItemHeight=e=>e.rect.element.height+.5*e.rect.element.marginBottom+.5*e.rect.element.marginTop,getItemWidth=e=>e.rect.element.width+.5*e.rect.element.marginLeft+.5*e.rect.element.marginRight,dragItem=({root:e,action:t})=>{const{id:r,dragState:o}=t,i=e.query("GET_ITEM",{id:r}),n=e.childViews.find((e=>e.id===r)),s=e.childViews.length,a=o.getItemIndex(i);if(!n)return;const l=n.dragOrigin.x+n.dragOffset.x+n.dragCenter.x,c=n.dragOrigin.y+n.dragOffset.y+n.dragCenter.y,d=getItemHeight(n),p=(u=n).rect.element.width+.5*u.rect.element.marginLeft+.5*u.rect.element.marginRight;var u;let E=Math.floor(e.rect.outer.width/p);E>s&&(E=s);const m=Math.floor(s/E+1);dropAreaDimensions.setHeight=d*m,dropAreaDimensions.setWidth=p*E;var I={y:Math.floor(c/d),x:Math.floor(l/p),getGridIndex:function(){return c>dropAreaDimensions.getHeight||c<0||l>dropAreaDimensions.getWidth||l<0?a:this.y*E+this.x},getColIndex:function(){const t=e.query("GET_ACTIVE_ITEMS"),r=e.childViews.filter((e=>e.rect.element.height)),o=t.map((e=>r.find((t=>t.id===e.id)))),i=o.findIndex((e=>e===n)),s=getItemHeight(n),a=o.length;let l=a,d=0,p=0,u=0;for(let e=0;e<a;e++)if(d=getItemHeight(o[e]),u=p,p=u+d,c<p){if(i>e){if(c<u+s){l=e;break}continue}l=e;break}return l}};const T=E>1?I.getGridIndex():I.getColIndex();e.dispatch("MOVE_ITEM",{query:n,index:T});const f=o.getIndex();if(void 0===f||f!==T){if(o.setIndex(T),void 0===f)return;e.dispatch("DID_REORDER_ITEMS",{items:e.query("GET_ACTIVE_ITEMS"),origin:a,target:T})}},route$2=createRoute({DID_ADD_ITEM:addItemView,DID_REMOVE_ITEM:removeItemView,DID_DRAG_ITEM:dragItem}),write$5=({root:e,props:t,actions:r,shouldOptimize:o})=>{route$2({root:e,props:t,actions:r});const{dragCoordinates:i}=t,n=e.rect.element.width,s=e.childViews.filter((e=>e.rect.element.height)),a=e.query("GET_ACTIVE_ITEMS").map((e=>s.find((t=>t.id===e.id)))).filter((e=>e)),l=i?getItemIndexByPosition(e,a,i):null,c=e.ref.addIndex||null;e.ref.addIndex=null;let d=0,p=0,u=0;if(0===a.length)return;const E=a[0].rect.element,m=E.marginTop+E.marginBottom,I=E.marginLeft+E.marginRight,T=E.width+I,f=E.height+m,g=getItemsPerRow(n,T);if(1===g){let e=0,t=0;a.forEach(((r,i)=>{if(l){let e=i-l;t=-2===e?.25*-m:-1===e?.75*-m:0===e?.75*m:1===e?.25*m:0}o&&(r.translateX=null,r.translateY=null),r.markedForRemoval||moveItem(r,0,e+t);let n=(r.rect.element.height+m)*(r.markedForRemoval?r.opacity:1);e+=n}))}else{let e=0,t=0;a.forEach(((r,i)=>{i===l&&(d=1),i===c&&(u+=1),r.markedForRemoval&&r.opacity<.5&&(p-=1);const n=i+u+d+p,s=n%g,a=Math.floor(n/g),E=s*T,m=a*f,I=Math.sign(E-e),_=Math.sign(m-t);e=E,t=m,r.markedForRemoval||(o&&(r.translateX=null,r.translateY=null),moveItem(r,E,m,I,_))}))}},filterSetItemActions=(e,t)=>t.filter((t=>!t.data||!t.data.id||e.id===t.data.id)),list=createView({create:create$8,write:write$5,tag:"ul",name:"list",didWriteView:({root:e})=>{e.childViews.filter((e=>e.markedForRemoval&&0===e.opacity&&e.resting)).forEach((t=>{t._destroy(),e.removeChildView(t)}))},filterFrameActionsForChild:filterSetItemActions,mixins:{apis:["dragCoordinates"]}}),create$9=({root:e,props:t})=>{e.ref.list=e.appendChildView(e.createChildView(list)),t.dragCoordinates=null,t.overflowing=!1},storeDragCoordinates=({root:e,props:t,action:r})=>{e.query("GET_ITEM_INSERT_LOCATION_FREEDOM")&&(t.dragCoordinates={left:r.position.scopeLeft-e.ref.list.rect.element.left,top:r.position.scopeTop-(e.rect.outer.top+e.rect.element.marginTop+e.rect.element.scrollTop)})},clearDragCoordinates=({props:e})=>{e.dragCoordinates=null},route$3=createRoute({DID_DRAG:storeDragCoordinates,DID_END_DRAG:clearDragCoordinates}),write$6=({root:e,props:t,actions:r})=>{if(route$3({root:e,props:t,actions:r}),e.ref.list.dragCoordinates=t.dragCoordinates,t.overflowing&&!t.overflow&&(t.overflowing=!1,e.element.dataset.state="",e.height=null),t.overflow){const r=Math.round(t.overflow);r!==e.height&&(t.overflowing=!0,e.element.dataset.state="overflow",e.height=r)}},listScroller=createView({create:create$9,write:write$6,name:"list-scroller",mixins:{apis:["overflow","dragCoordinates"],styles:["height","translateY"],animations:{translateY:"spring"}}}),attrToggle=(e,t,r,o="")=>{r?attr(e,t,o):e.removeAttribute(t)},resetFileInput=e=>{if(e&&""!==e.value){try{e.value=""}catch(e){}if(e.value){const t=createElement$1("form"),r=e.parentNode,o=e.nextSibling;t.appendChild(e),t.reset(),o?r.insertBefore(e,o):r.appendChild(e)}}},create$a=({root:e,props:t})=>{e.element.id=`filepond--browser-${t.id}`,attr(e.element,"name",e.query("GET_NAME")),attr(e.element,"aria-controls",`filepond--assistant-${t.id}`),attr(e.element,"aria-labelledby",`filepond--drop-label-${t.id}`),setAcceptedFileTypes({root:e,action:{value:e.query("GET_ACCEPTED_FILE_TYPES")}}),toggleAllowMultiple({root:e,action:{value:e.query("GET_ALLOW_MULTIPLE")}}),toggleDirectoryFilter({root:e,action:{value:e.query("GET_ALLOW_DIRECTORIES_ONLY")}}),toggleDisabled({root:e}),toggleRequired({root:e,action:{value:e.query("GET_REQUIRED")}}),setCaptureMethod({root:e,action:{value:e.query("GET_CAPTURE_METHOD")}}),e.ref.handleChange=r=>{if(!e.element.value)return;const o=Array.from(e.element.files).map((e=>(e._relativePath=e.webkitRelativePath,e)));setTimeout((()=>{t.onload(o),resetFileInput(e.element)}),250)},e.element.addEventListener("change",e.ref.handleChange)},setAcceptedFileTypes=({root:e,action:t})=>{e.query("GET_ALLOW_SYNC_ACCEPT_ATTRIBUTE")&&attrToggle(e.element,"accept",!!t.value,t.value?t.value.join(","):"")},toggleAllowMultiple=({root:e,action:t})=>{attrToggle(e.element,"multiple",t.value)},toggleDirectoryFilter=({root:e,action:t})=>{attrToggle(e.element,"webkitdirectory",t.value)},toggleDisabled=({root:e})=>{const t=e.query("GET_DISABLED"),r=e.query("GET_ALLOW_BROWSE"),o=t||!r;attrToggle(e.element,"disabled",o)},toggleRequired=({root:e,action:t})=>{t.value?0===e.query("GET_TOTAL_ITEMS")&&attrToggle(e.element,"required",!0):attrToggle(e.element,"required",!1)},setCaptureMethod=({root:e,action:t})=>{attrToggle(e.element,"capture",!!t.value,!0===t.value?"":t.value)},updateRequiredStatus=({root:e})=>{const{element:t}=e;if(e.query("GET_TOTAL_ITEMS")>0)attrToggle(t,"required",!1),attrToggle(t,"name",!1);else{attrToggle(t,"name",!0,e.query("GET_NAME"));e.query("GET_CHECK_VALIDITY")&&t.setCustomValidity(""),e.query("GET_REQUIRED")&&attrToggle(t,"required",!0)}},updateFieldValidityStatus=({root:e})=>{e.query("GET_CHECK_VALIDITY")&&e.element.setCustomValidity(e.query("GET_LABEL_INVALID_FIELD"))},browser=createView({tag:"input",name:"browser",ignoreRect:!0,ignoreRectUpdate:!0,attributes:{type:"file"},create:create$a,destroy:({root:e})=>{e.element.removeEventListener("change",e.ref.handleChange)},write:createRoute({DID_LOAD_ITEM:updateRequiredStatus,DID_REMOVE_ITEM:updateRequiredStatus,DID_THROW_ITEM_INVALID:updateFieldValidityStatus,DID_SET_DISABLED:toggleDisabled,DID_SET_ALLOW_BROWSE:toggleDisabled,DID_SET_ALLOW_DIRECTORIES_ONLY:toggleDirectoryFilter,DID_SET_ALLOW_MULTIPLE:toggleAllowMultiple,DID_SET_ACCEPTED_FILE_TYPES:setAcceptedFileTypes,DID_SET_CAPTURE_METHOD:setCaptureMethod,DID_SET_REQUIRED:toggleRequired})}),Key={ENTER:13,SPACE:32},create$b=({root:e,props:t})=>{const r=createElement$1("label");attr(r,"for",`filepond--browser-${t.id}`),attr(r,"id",`filepond--drop-label-${t.id}`),attr(r,"aria-hidden","true"),e.ref.handleKeyDown=t=>{(t.keyCode===Key.ENTER||t.keyCode===Key.SPACE)&&(t.preventDefault(),e.ref.label.click())},e.ref.handleClick=t=>{t.target===r||r.contains(t.target)||e.ref.label.click()},r.addEventListener("keydown",e.ref.handleKeyDown),e.element.addEventListener("click",e.ref.handleClick),updateLabelValue(r,t.caption),e.appendChild(r),e.ref.label=r},updateLabelValue=(e,t)=>{e.innerHTML=t;const r=e.querySelector(".filepond--label-action");return r&&attr(r,"tabindex","0"),t},dropLabel=createView({name:"drop-label",ignoreRect:!0,create:create$b,destroy:({root:e})=>{e.ref.label.addEventListener("keydown",e.ref.handleKeyDown),e.element.removeEventListener("click",e.ref.handleClick)},write:createRoute({DID_SET_LABEL_IDLE:({root:e,action:t})=>{updateLabelValue(e.ref.label,t.value)}}),mixins:{styles:["opacity","translateX","translateY"],animations:{opacity:{type:"tween",duration:150},translateX:"spring",translateY:"spring"}}}),blob=createView({name:"drip-blob",ignoreRect:!0,mixins:{styles:["translateX","translateY","scaleX","scaleY","opacity"],animations:{scaleX:"spring",scaleY:"spring",translateX:"spring",translateY:"spring",opacity:{type:"tween",duration:250}}}}),addBlob=({root:e})=>{const t=.5*e.rect.element.width,r=.5*e.rect.element.height;e.ref.blob=e.appendChildView(e.createChildView(blob,{opacity:0,scaleX:2.5,scaleY:2.5,translateX:t,translateY:r}))},moveBlob=({root:e,action:t})=>{e.ref.blob?(e.ref.blob.translateX=t.position.scopeLeft,e.ref.blob.translateY=t.position.scopeTop,e.ref.blob.scaleX=1,e.ref.blob.scaleY=1,e.ref.blob.opacity=1):addBlob({root:e})},hideBlob=({root:e})=>{e.ref.blob&&(e.ref.blob.opacity=0)},explodeBlob=({root:e})=>{e.ref.blob&&(e.ref.blob.scaleX=2.5,e.ref.blob.scaleY=2.5,e.ref.blob.opacity=0)},write$7=({root:e,props:t,actions:r})=>{route$4({root:e,props:t,actions:r});const{blob:o}=e.ref;0===r.length&&o&&0===o.opacity&&(e.removeChildView(o),e.ref.blob=null)},route$4=createRoute({DID_DRAG:moveBlob,DID_DROP:explodeBlob,DID_END_DRAG:hideBlob}),drip=createView({ignoreRect:!0,ignoreRectUpdate:!0,name:"drip",write:write$7}),setInputFiles=(e,t)=>{try{const r=new DataTransfer;t.forEach((e=>{e instanceof File?r.items.add(e):r.items.add(new File([e],e.name,{type:e.type}))})),e.files=r.files}catch(e){return!1}return!0},create$c=({root:e})=>e.ref.fields={},getField=(e,t)=>e.ref.fields[t],syncFieldPositionsWithItems=e=>{e.query("GET_ACTIVE_ITEMS").forEach((t=>{e.ref.fields[t.id]&&e.element.appendChild(e.ref.fields[t.id])}))},didReorderItems=({root:e})=>syncFieldPositionsWithItems(e),didAddItem=({root:e,action:t})=>{const r=!(e.query("GET_ITEM",t.id).origin===FileOrigin.LOCAL)&&e.query("SHOULD_UPDATE_FILE_INPUT"),o=createElement$1("input");o.type=r?"file":"hidden",o.name=e.query("GET_NAME"),o.disabled=e.query("GET_DISABLED"),e.ref.fields[t.id]=o,syncFieldPositionsWithItems(e)},didLoadItem$1=({root:e,action:t})=>{const r=getField(e,t.id);if(!r)return;if(null!==t.serverFileReference&&(r.value=t.serverFileReference),!e.query("SHOULD_UPDATE_FILE_INPUT"))return;const o=e.query("GET_ITEM",t.id);setInputFiles(r,[o.file])},didPrepareOutput=({root:e,action:t})=>{e.query("SHOULD_UPDATE_FILE_INPUT")&&setTimeout((()=>{const r=getField(e,t.id);r&&setInputFiles(r,[t.file])}),0)},didSetDisabled=({root:e})=>{e.element.disabled=e.query("GET_DISABLED")},didRemoveItem=({root:e,action:t})=>{const r=getField(e,t.id);r&&(r.parentNode&&r.parentNode.removeChild(r),delete e.ref.fields[t.id])},didDefineValue=({root:e,action:t})=>{const r=getField(e,t.id);r&&(null===t.value?r.removeAttribute("value"):r.value=t.value,syncFieldPositionsWithItems(e))},write$8=createRoute({DID_SET_DISABLED:didSetDisabled,DID_ADD_ITEM:didAddItem,DID_LOAD_ITEM:didLoadItem$1,DID_REMOVE_ITEM:didRemoveItem,DID_DEFINE_VALUE:didDefineValue,DID_PREPARE_OUTPUT:didPrepareOutput,DID_REORDER_ITEMS:didReorderItems,DID_SORT_ITEMS:didReorderItems}),data=createView({tag:"fieldset",name:"data",create:create$c,write:write$8,ignoreRect:!0}),getRootNode=e=>"getRootNode"in e?e.getRootNode():document,images=["jpg","jpeg","png","gif","bmp","webp","svg","tiff"],text$1=["css","csv","html","txt"],map={zip:"zip|compressed",epub:"application/epub+zip"},guesstimateMimeType=(e="")=>(e=e.toLowerCase(),images.includes(e)?"image/"+("jpg"===e?"jpeg":"svg"===e?"svg+xml":e):text$1.includes(e)?"text/"+e:map[e]||""),requestDataTransferItems=e=>new Promise(((t,r)=>{const o=getLinks(e);if(o.length&&!hasFiles(e))return t(o);getFiles(e).then(t)})),hasFiles=e=>!!e.files&&e.files.length>0,getFiles=e=>new Promise(((t,r)=>{const o=(e.items?Array.from(e.items):[]).filter((e=>isFileSystemItem(e))).map((e=>getFilesFromItem(e)));o.length?Promise.all(o).then((e=>{const r=[];e.forEach((e=>{r.push.apply(r,e)})),t(r.filter((e=>e)).map((e=>(e._relativePath||(e._relativePath=e.webkitRelativePath),e))))})).catch(console.error):t(e.files?Array.from(e.files):[])})),isFileSystemItem=e=>{if(isEntry(e)){const t=getAsEntry(e);if(t)return t.isFile||t.isDirectory}return"file"===e.kind},getFilesFromItem=e=>new Promise(((t,r)=>{isDirectoryEntry(e)?getFilesInDirectory(getAsEntry(e)).then(t).catch(r):t([e.getAsFile()])})),getFilesInDirectory=e=>new Promise(((t,r)=>{const o=[];let i=0,n=0;const s=()=>{0===n&&0===i&&t(o)},a=e=>{i++;const t=e.createReader(),l=()=>{t.readEntries((e=>{if(0===e.length)return i--,void s();e.forEach((e=>{e.isDirectory?a(e):(n++,e.file((t=>{const r=correctMissingFileType(t);e.fullPath&&(r._relativePath=e.fullPath),o.push(r),n--,s()})))})),l()}),r)};l()};a(e)})),correctMissingFileType=e=>{if(e.type.length)return e;const t=e.lastModifiedDate,r=e.name,o=guesstimateMimeType(getExtensionFromFilename(e.name));return o.length?((e=e.slice(0,e.size,o)).name=r,e.lastModifiedDate=t,e):e},isDirectoryEntry=e=>isEntry(e)&&(getAsEntry(e)||{}).isDirectory,isEntry=e=>"webkitGetAsEntry"in e,getAsEntry=e=>e.webkitGetAsEntry(),getLinks=e=>{let t=[];try{if(t=getLinksFromTransferMetaData(e),t.length)return t;t=getLinksFromTransferURLData(e)}catch(e){}return t},getLinksFromTransferURLData=e=>{let t=e.getData("url");return"string"==typeof t&&t.length?[t]:[]},getLinksFromTransferMetaData=e=>{let t=e.getData("text/html");if("string"==typeof t&&t.length){const e=t.match(/src\s*=\s*"(.+?)"/);if(e)return[e[1]]}return[]},dragNDropObservers=[],eventPosition=e=>({pageLeft:e.pageX,pageTop:e.pageY,scopeLeft:e.offsetX||e.layerX,scopeTop:e.offsetY||e.layerY}),createDragNDropClient=(e,t,r)=>{const o=getDragNDropObserver(t),i={element:e,filterElement:r,state:null,ondrop:()=>{},onenter:()=>{},ondrag:()=>{},onexit:()=>{},onload:()=>{},allowdrop:()=>{}};return i.destroy=o.addListener(i),i},getDragNDropObserver=e=>{const t=dragNDropObservers.find((t=>t.element===e));if(t)return t;const r=createDragNDropObserver(e);return dragNDropObservers.push(r),r},createDragNDropObserver=e=>{const t=[],r={dragenter:dragenter,dragover:dragover,dragleave:dragleave,drop:drop},o={};forin(r,((r,i)=>{o[r]=i(e,t),e.addEventListener(r,o[r],!1)}));const i={element:e,addListener:n=>(t.push(n),()=>{t.splice(t.indexOf(n),1),0===t.length&&(dragNDropObservers.splice(dragNDropObservers.indexOf(i),1),forin(r,(t=>{e.removeEventListener(t,o[t],!1)})))})};return i},elementFromPoint=(e,t)=>("elementFromPoint"in e||(e=document),e.elementFromPoint(t.x,t.y)),isEventTarget=(e,t)=>{const r="getRootNode"in(o=t)?o.getRootNode():document;var o;const i=elementFromPoint(r,{x:e.pageX-window.pageXOffset,y:e.pageY-window.pageYOffset});return i===t||t.contains(i)};let initialTarget=null;const setDropEffect=(e,t)=>{try{e.dropEffect=t}catch(e){}},dragenter=(e,t)=>e=>{e.preventDefault(),initialTarget=e.target,t.forEach((t=>{const{element:r,onenter:o}=t;isEventTarget(e,r)&&(t.state="enter",o(eventPosition(e)))}))},dragover=(e,t)=>e=>{e.preventDefault();const r=e.dataTransfer;requestDataTransferItems(r).then((o=>{let i=!1;t.some((t=>{const{filterElement:n,element:s,onenter:a,onexit:l,ondrag:c,allowdrop:d}=t;setDropEffect(r,"copy");const p=d(o);if(p)if(isEventTarget(e,s)){if(i=!0,null===t.state)return t.state="enter",void a(eventPosition(e));if(t.state="over",n&&!p)return void setDropEffect(r,"none");c(eventPosition(e))}else n&&!i&&setDropEffect(r,"none"),t.state&&(t.state=null,l(eventPosition(e)));else setDropEffect(r,"none")}))}))},drop=(e,t)=>e=>{e.preventDefault();const r=e.dataTransfer;requestDataTransferItems(r).then((r=>{t.forEach((t=>{const{filterElement:o,element:i,ondrop:n,onexit:s,allowdrop:a}=t;if(t.state=null,!o||isEventTarget(e,i))return a(r)?void n(eventPosition(e),r):s(eventPosition(e))}))}))},dragleave=(e,t)=>e=>{initialTarget===e.target&&t.forEach((t=>{const{onexit:r}=t;t.state=null,r(eventPosition(e))}))},createHopper=(e,t,r)=>{e.classList.add("filepond--hopper");const{catchesDropsOnPage:o,requiresDropOnElement:i,filterItems:n=(e=>e)}=r,s=createDragNDropClient(e,o?document.documentElement:e,i);let a="",l="";s.allowdrop=e=>t(n(e)),s.ondrop=(e,r)=>{const o=n(r);t(o)?(l="drag-drop",c.onload(o,e)):c.ondragend(e)},s.ondrag=e=>{c.ondrag(e)},s.onenter=e=>{l="drag-over",c.ondragstart(e)},s.onexit=e=>{l="drag-exit",c.ondragend(e)};const c={updateHopperState:()=>{a!==l&&(e.dataset.hopperState=l,a=l)},onload:()=>{},ondragstart:()=>{},ondrag:()=>{},ondragend:()=>{},destroy:()=>{s.destroy()}};return c};let listening=!1;const listeners$1=[],handlePaste=e=>{const t=document.activeElement;if(t&&/textarea|input/i.test(t.nodeName)){let e=!1,r=t;for(;r!==document.body;){if(r.classList.contains("filepond--root")){e=!0;break}r=r.parentNode}if(!e)return}requestDataTransferItems(e.clipboardData).then((e=>{e.length&&listeners$1.forEach((t=>t(e)))}))},listen=e=>{listeners$1.includes(e)||(listeners$1.push(e),listening||(listening=!0,document.addEventListener("paste",handlePaste)))},unlisten=e=>{arrayRemove(listeners$1,listeners$1.indexOf(e)),0===listeners$1.length&&(document.removeEventListener("paste",handlePaste),listening=!1)},createPaster=()=>{const e=e=>{t.onload(e)},t={destroy:()=>{var t;t=e,arrayRemove(listeners$1,listeners$1.indexOf(t)),0===listeners$1.length&&(document.removeEventListener("paste",handlePaste),listening=!1)},onload:()=>{}};return listen(e),t},create$d=({root:e,props:t})=>{e.element.id=`filepond--assistant-${t.id}`,attr(e.element,"role","status"),attr(e.element,"aria-live","polite"),attr(e.element,"aria-relevant","additions")};let addFilesNotificationTimeout=null,notificationClearTimeout=null;const filenames=[],assist=(e,t)=>{e.element.textContent=t},clear$1=e=>{e.element.textContent=""},listModified=(e,t,r)=>{const o=e.query("GET_TOTAL_ITEMS");assist(e,`${r} ${t}, ${o} ${1===o?e.query("GET_LABEL_FILE_COUNT_SINGULAR"):e.query("GET_LABEL_FILE_COUNT_PLURAL")}`),clearTimeout(notificationClearTimeout),notificationClearTimeout=setTimeout((()=>{clear$1(e)}),1500)},isUsingFilePond=e=>e.element.parentNode.contains(document.activeElement),itemAdded=({root:e,action:t})=>{if(!isUsingFilePond(e))return;e.element.textContent="";const r=e.query("GET_ITEM",t.id);filenames.push(r.filename),clearTimeout(addFilesNotificationTimeout),addFilesNotificationTimeout=setTimeout((()=>{listModified(e,filenames.join(", "),e.query("GET_LABEL_FILE_ADDED")),filenames.length=0}),750)},itemRemoved=({root:e,action:t})=>{if(!isUsingFilePond(e))return;const r=t.item;listModified(e,r.filename,e.query("GET_LABEL_FILE_REMOVED"))},itemProcessed=({root:e,action:t})=>{const r=e.query("GET_ITEM",t.id).filename,o=e.query("GET_LABEL_FILE_PROCESSING_COMPLETE");assist(e,`${r} ${o}`)},itemProcessedUndo=({root:e,action:t})=>{const r=e.query("GET_ITEM",t.id).filename,o=e.query("GET_LABEL_FILE_PROCESSING_ABORTED");assist(e,`${r} ${o}`)},itemError=({root:e,action:t})=>{const r=e.query("GET_ITEM",t.id).filename;assist(e,`${t.status.main} ${r} ${t.status.sub}`)},assistant=createView({create:create$d,ignoreRect:!0,ignoreRectUpdate:!0,write:createRoute({DID_LOAD_ITEM:itemAdded,DID_REMOVE_ITEM:itemRemoved,DID_COMPLETE_ITEM_PROCESSING:itemProcessed,DID_ABORT_ITEM_PROCESSING:itemProcessedUndo,DID_REVERT_ITEM_PROCESSING:itemProcessedUndo,DID_THROW_ITEM_REMOVE_ERROR:itemError,DID_THROW_ITEM_LOAD_ERROR:itemError,DID_THROW_ITEM_INVALID:itemError,DID_THROW_ITEM_PROCESSING_ERROR:itemError}),tag:"span",name:"assistant"}),toCamels=(e,t="-")=>e.replace(new RegExp(`${t}.`,"g"),(e=>e.charAt(1).toUpperCase())),debounce=(e,t=16,r=!0)=>{let o=Date.now(),i=null;return(...n)=>{clearTimeout(i);const s=Date.now()-o,a=()=>{o=Date.now(),e(...n)};s<t?r||(i=setTimeout(a,t-s)):a()}},MAX_FILES_LIMIT=1e6,prevent=e=>e.preventDefault(),create$e=({root:e,props:t})=>{const r=e.query("GET_ID");r&&(e.element.id=r);const o=e.query("GET_CLASS_NAME");o&&o.split(" ").filter((e=>e.length)).forEach((t=>{e.element.classList.add(t)})),e.ref.label=e.appendChildView(e.createChildView(dropLabel,{...t,translateY:null,caption:e.query("GET_LABEL_IDLE")})),e.ref.list=e.appendChildView(e.createChildView(listScroller,{translateY:null})),e.ref.panel=e.appendChildView(e.createChildView(panel,{name:"panel-root"})),e.ref.assistant=e.appendChildView(e.createChildView(assistant,{...t})),e.ref.data=e.appendChildView(e.createChildView(data,{...t})),e.ref.measure=createElement$1("div"),e.ref.measure.style.height="100%",e.element.appendChild(e.ref.measure),e.ref.bounds=null,e.query("GET_STYLES").filter((e=>!isEmpty(e.value))).map((({name:t,value:r})=>{e.element.dataset[t]=r})),e.ref.widthPrevious=null,e.ref.widthUpdated=debounce((()=>{e.ref.updateHistory=[],e.dispatch("DID_RESIZE_ROOT")}),250),e.ref.previousAspectRatio=null,e.ref.updateHistory=[];const i=window.matchMedia("(pointer: fine) and (hover: hover)").matches,n="PointerEvent"in window;e.query("GET_ALLOW_REORDER")&&n&&!i&&(e.element.addEventListener("touchmove",prevent,{passive:!1}),e.element.addEventListener("gesturestart",prevent));const s=e.query("GET_CREDITS");if(2===s.length){const t=document.createElement("a");t.className="filepond--credits",t.setAttribute("aria-hidden","true"),t.href=s[0],t.tabindex=-1,t.target="_blank",t.rel="noopener noreferrer",t.textContent=s[1],e.element.appendChild(t),e.ref.credits=t}},write$9=({root:e,props:t,actions:r})=>{if(route$5({root:e,props:t,actions:r}),r.filter((e=>/^DID_SET_STYLE_/.test(e.type))).filter((e=>!isEmpty(e.data.value))).map((({type:t,data:r})=>{const o=toCamels(t.substr(8).toLowerCase(),"_");e.element.dataset[o]=r.value,e.invalidateLayout()})),e.rect.element.hidden)return;e.rect.element.width!==e.ref.widthPrevious&&(e.ref.widthPrevious=e.rect.element.width,e.ref.widthUpdated());let o=e.ref.bounds;o||(o=e.ref.bounds=calculateRootBoundingBoxHeight(e),e.element.removeChild(e.ref.measure),e.ref.measure=null);const{hopper:i,label:n,list:s,panel:a}=e.ref;i&&i.updateHopperState();const l=e.query("GET_PANEL_ASPECT_RATIO"),c=e.query("GET_ALLOW_MULTIPLE"),d=e.query("GET_TOTAL_ITEMS"),p=d===(c?e.query("GET_MAX_FILES")||1e6:1),u=r.find((e=>"DID_ADD_ITEM"===e.type));if(p&&u){const e=u.data.interactionMethod;n.opacity=0,c?n.translateY=-40:e===InteractionMethod.API?n.translateX=40:n.translateY=e===InteractionMethod.BROWSE?40:30}else p||(n.opacity=1,n.translateX=0,n.translateY=0);const E=calculateListItemMargin(e),m=calculateListHeight(e),I=n.rect.element.height,T=!c||p?0:I,f=p?s.rect.element.marginTop:0,g=0===d?0:s.rect.element.marginBottom,_=T+f+m.visual+g,R=T+f+m.bounds+g;if(s.translateY=Math.max(0,T-s.rect.element.marginTop)-E.top,l){const t=e.rect.element.width,r=t*l;l!==e.ref.previousAspectRatio&&(e.ref.previousAspectRatio=l,e.ref.updateHistory=[]);const o=e.ref.updateHistory;o.push(t);const i=2;if(o.length>2*i){const e=o.length,t=e-10;let r=0;for(let n=e;n>=t;n--)if(o[n]===o[n-2]&&r++,r>=i)return}a.scalable=!1,a.height=r;const n=r-T-(g-E.bottom)-(p?f:0);m.visual>n?s.overflow=n:s.overflow=null,e.height=r}else if(o.fixedHeight){a.scalable=!1;const e=o.fixedHeight-T-(g-E.bottom)-(p?f:0);m.visual>e?s.overflow=e:s.overflow=null}else if(o.cappedHeight){const t=_>=o.cappedHeight,r=Math.min(o.cappedHeight,_);a.scalable=!0,a.height=t?r:r-E.top-E.bottom;const i=r-T-(g-E.bottom)-(p?f:0);_>o.cappedHeight&&m.visual>i?s.overflow=i:s.overflow=null,e.height=Math.min(o.cappedHeight,R-E.top-E.bottom)}else{const t=d>0?E.top+E.bottom:0;a.scalable=!0,a.height=Math.max(I,_-t),e.height=Math.max(I,R-t)}e.ref.credits&&a.heightCurrent&&(e.ref.credits.style.transform=`translateY(${a.heightCurrent}px)`)},calculateListItemMargin=e=>{const t=e.ref.list.childViews[0].childViews[0];return t?{top:t.rect.element.marginTop,bottom:t.rect.element.marginBottom}:{top:0,bottom:0}},calculateListHeight=e=>{let t=0,r=0;const o=e.ref.list,i=o.childViews[0],n=i.childViews.filter((e=>e.rect.element.height)),s=e.query("GET_ACTIVE_ITEMS").map((e=>n.find((t=>t.id===e.id)))).filter((e=>e));if(0===s.length)return{visual:t,bounds:r};const a=i.rect.element.width,l=getItemIndexByPosition(i,s,o.dragCoordinates),c=s[0].rect.element,d=c.marginTop+c.marginBottom,p=c.marginLeft+c.marginRight,u=c.width+p,E=c.height+d,m=void 0!==l&&l>=0?1:0,I=s.find((e=>e.markedForRemoval&&e.opacity<.45))?-1:0,T=s.length+m+I,f=getItemsPerRow(a,u);return 1===f?s.forEach((e=>{const o=e.rect.element.height+d;r+=o,t+=o*e.opacity})):(r=Math.ceil(T/f)*E,t=r),{visual:t,bounds:r}},calculateRootBoundingBoxHeight=e=>{const t=e.ref.measureHeight||null;return{cappedHeight:parseInt(e.style.maxHeight,10)||null,fixedHeight:0===t?null:t}},exceedsMaxFiles=(e,t)=>{const r=e.query("GET_ALLOW_REPLACE"),o=e.query("GET_ALLOW_MULTIPLE"),i=e.query("GET_TOTAL_ITEMS");let n=e.query("GET_MAX_FILES");const s=t.length;if(!o&&s>1)return!0;n=o||r?n:1;return!!(isInt(n)&&i+s>n)&&(e.dispatch("DID_THROW_MAX_FILES",{source:t,error:createResponse("warning",0,"Max files")}),!0)},getDragIndex=(e,t,r)=>{const o=e.childViews[0];return getItemIndexByPosition(o,t,{left:r.scopeLeft-o.rect.element.left,top:r.scopeTop-(e.rect.outer.top+e.rect.element.marginTop+e.rect.element.scrollTop)})},toggleDrop=e=>{const t=e.query("GET_ALLOW_DROP"),r=e.query("GET_DISABLED"),o=t&&!r;if(o&&!e.ref.hopper){const t=createHopper(e.element,(t=>{const r=e.query("GET_BEFORE_DROP_FILE")||(()=>!0);return!e.query("GET_DROP_VALIDATION")||t.every((t=>applyFilters("ALLOW_HOPPER_ITEM",t,{query:e.query}).every((e=>!0===e))&&r(t)))}),{filterItems:t=>{const r=e.query("GET_IGNORED_FILES");return t.filter((e=>!isFile(e)||!r.includes(e.name.toLowerCase())))},catchesDropsOnPage:e.query("GET_DROP_ON_PAGE"),requiresDropOnElement:e.query("GET_DROP_ON_ELEMENT")});t.onload=(t,r)=>{const o=e.ref.list.childViews[0].childViews.filter((e=>e.rect.element.height)),i=e.query("GET_ACTIVE_ITEMS").map((e=>o.find((t=>t.id===e.id)))).filter((e=>e));applyFilterChain("ADD_ITEMS",t,{dispatch:e.dispatch}).then((t=>{if(exceedsMaxFiles(e,t))return!1;e.dispatch("ADD_ITEMS",{items:t,index:getDragIndex(e.ref.list,i,r),interactionMethod:InteractionMethod.DROP})})),e.dispatch("DID_DROP",{position:r}),e.dispatch("DID_END_DRAG",{position:r})},t.ondragstart=t=>{e.dispatch("DID_START_DRAG",{position:t})},t.ondrag=debounce((t=>{e.dispatch("DID_DRAG",{position:t})})),t.ondragend=t=>{e.dispatch("DID_END_DRAG",{position:t})},e.ref.hopper=t,e.ref.drip=e.appendChildView(e.createChildView(drip))}else!o&&e.ref.hopper&&(e.ref.hopper.destroy(),e.ref.hopper=null,e.removeChildView(e.ref.drip))},toggleBrowse=(e,t)=>{const r=e.query("GET_ALLOW_BROWSE"),o=e.query("GET_DISABLED"),i=r&&!o;i&&!e.ref.browser?e.ref.browser=e.appendChildView(e.createChildView(browser,{...t,onload:t=>{applyFilterChain("ADD_ITEMS",t,{dispatch:e.dispatch}).then((t=>{if(exceedsMaxFiles(e,t))return!1;e.dispatch("ADD_ITEMS",{items:t,index:-1,interactionMethod:InteractionMethod.BROWSE})}))}}),0):!i&&e.ref.browser&&(e.removeChildView(e.ref.browser),e.ref.browser=null)},togglePaste=e=>{const t=e.query("GET_ALLOW_PASTE"),r=e.query("GET_DISABLED"),o=t&&!r;o&&!e.ref.paster?(e.ref.paster=createPaster(),e.ref.paster.onload=t=>{applyFilterChain("ADD_ITEMS",t,{dispatch:e.dispatch}).then((t=>{if(exceedsMaxFiles(e,t))return!1;e.dispatch("ADD_ITEMS",{items:t,index:-1,interactionMethod:InteractionMethod.PASTE})}))}):!o&&e.ref.paster&&(e.ref.paster.destroy(),e.ref.paster=null)},route$5=createRoute({DID_SET_ALLOW_BROWSE:({root:e,props:t})=>{toggleBrowse(e,t)},DID_SET_ALLOW_DROP:({root:e})=>{toggleDrop(e)},DID_SET_ALLOW_PASTE:({root:e})=>{togglePaste(e)},DID_SET_DISABLED:({root:e,props:t})=>{toggleDrop(e),togglePaste(e),toggleBrowse(e,t);e.query("GET_DISABLED")?e.element.dataset.disabled="disabled":e.element.removeAttribute("data-disabled")}}),root=createView({name:"root",read:({root:e})=>{e.ref.measure&&(e.ref.measureHeight=e.ref.measure.offsetHeight)},create:create$e,write:write$9,destroy:({root:e})=>{e.ref.paster&&e.ref.paster.destroy(),e.ref.hopper&&e.ref.hopper.destroy(),e.element.removeEventListener("touchmove",prevent),e.element.removeEventListener("gesturestart",prevent)},mixins:{styles:["height"]}}),createApp=(e={})=>{let t=null;const r=getOptions(),o=createStore({items:[],listUpdateTimeout:null,itemUpdateTimeout:null,processingQueue:[],options:createOptions(r)},[queries,createOptionQueries(r)],[actions,createOptionActions(r)]);o.dispatch("SET_OPTIONS",{options:e});const i=()=>{document.hidden||o.dispatch("KICK")};document.addEventListener("visibilitychange",i);let n=null,s=!1,a=!1,l=null,c=null;const d=()=>{s||(s=!0),clearTimeout(n),n=setTimeout((()=>{s=!1,l=null,c=null,a&&(a=!1,o.dispatch("DID_STOP_RESIZE"))}),500)};window.addEventListener("resize",d);const p=root(o,{id:getUniqueId()});let u=!1,E=!1;const m={_read:()=>{s&&(c=window.innerWidth,l||(l=c),a||c===l||(o.dispatch("DID_START_RESIZE"),a=!0)),E&&u&&(u=null===p.element.offsetParent),u||(p._read(),E=p.rect.element.hidden)},_write:e=>{const t=o.processActionQueue().filter((e=>!/^SET_/.test(e.type)));var r;u&&!t.length||(g(t),u=p._write(e,t,a),(r=o.query("GET_ITEMS")).forEach(((e,t)=>{e.released&&arrayRemove(r,t)})),u&&o.processDispatchQueue())}},I=e=>t=>{const r={type:e};if(!t)return r;if(t.hasOwnProperty("error")&&(r.error=t.error?{...t.error}:null),t.status&&(r.status={...t.status}),t.file&&(r.output=t.file),t.source)r.file=t.source;else if(t.item||t.id){const e=t.item?t.item:o.query("GET_ITEM",t.id);r.file=e?createItemAPI(e):null}return t.items&&(r.items=t.items.map(createItemAPI)),/progress/.test(e)&&(r.progress=t.progress),t.hasOwnProperty("origin")&&t.hasOwnProperty("target")&&(r.origin=t.origin,r.target=t.target),r},T={DID_DESTROY:I("destroy"),DID_INIT:I("init"),DID_THROW_MAX_FILES:I("warning"),DID_INIT_ITEM:I("initfile"),DID_START_ITEM_LOAD:I("addfilestart"),DID_UPDATE_ITEM_LOAD_PROGRESS:I("addfileprogress"),DID_LOAD_ITEM:I("addfile"),DID_THROW_ITEM_INVALID:[I("error"),I("addfile")],DID_THROW_ITEM_LOAD_ERROR:[I("error"),I("addfile")],DID_THROW_ITEM_REMOVE_ERROR:[I("error"),I("removefile")],DID_PREPARE_OUTPUT:I("preparefile"),DID_START_ITEM_PROCESSING:I("processfilestart"),DID_UPDATE_ITEM_PROCESS_PROGRESS:I("processfileprogress"),DID_ABORT_ITEM_PROCESSING:I("processfileabort"),DID_COMPLETE_ITEM_PROCESSING:I("processfile"),DID_COMPLETE_ITEM_PROCESSING_ALL:I("processfiles"),DID_REVERT_ITEM_PROCESSING:I("processfilerevert"),DID_THROW_ITEM_PROCESSING_ERROR:[I("error"),I("processfile")],DID_REMOVE_ITEM:I("removefile"),DID_UPDATE_ITEMS:I("updatefiles"),DID_ACTIVATE_ITEM:I("activatefile"),DID_REORDER_ITEMS:I("reorderfiles")},f=e=>{const t={pond:S,...e};delete t.type,p.element.dispatchEvent(new CustomEvent(`FilePond:${e.type}`,{detail:t,bubbles:!0,cancelable:!0,composed:!0}));const r=[];e.hasOwnProperty("error")&&r.push(e.error),e.hasOwnProperty("file")&&r.push(e.file);const i=["type","error","file"];Object.keys(e).filter((e=>!i.includes(e))).forEach((t=>r.push(e[t]))),S.fire(e.type,...r);const n=o.query(`GET_ON${e.type.toUpperCase()}`);n&&n(...r)},g=e=>{e.length&&e.filter((e=>T[e.type])).forEach((e=>{const t=T[e.type];(Array.isArray(t)?t:[t]).forEach((t=>{"DID_INIT_ITEM"===e.type?f(t(e.data)):setTimeout((()=>{f(t(e.data))}),0)}))}))},_=e=>new Promise(((t,r)=>{o.dispatch("REQUEST_ITEM_PREPARE",{query:e,success:e=>{t(e)},failure:e=>{r(e)}})})),R=(e,t)=>{var r;return"object"!=typeof e||(r=e).file&&r.id||t||(t=e,e=void 0),o.dispatch("REMOVE_ITEM",{...t,query:e}),null===o.query("GET_ACTIVE_ITEM",e)},h=(...e)=>new Promise(((t,r)=>{const i=[],n={};if(isArray(e[0]))i.push.apply(i,e[0]),Object.assign(n,e[1]||{});else{const t=e[e.length-1];"object"!=typeof t||t instanceof Blob||Object.assign(n,e.pop()),i.push(...e)}o.dispatch("ADD_ITEMS",{items:i,index:n.index,interactionMethod:InteractionMethod.API,success:t,failure:r})})),y=()=>o.query("GET_ACTIVE_ITEMS"),O=e=>new Promise(((t,r)=>{o.dispatch("REQUEST_ITEM_PROCESSING",{query:e,success:e=>{t(e)},failure:e=>{r(e)}})})),S={...on(),...m,...createOptionAPI(o,r),setOptions:e=>o.dispatch("SET_OPTIONS",{options:e}),addFile:(e,t={})=>new Promise(((r,o)=>{h([{source:e,options:t}],{index:t.index}).then((e=>r(e&&e[0]))).catch(o)})),addFiles:h,getFile:e=>o.query("GET_ACTIVE_ITEM",e),processFile:O,prepareFile:_,removeFile:R,moveFile:(e,t)=>o.dispatch("MOVE_ITEM",{query:e,index:t}),getFiles:y,processFiles:(...e)=>{const t=Array.isArray(e[0])?e[0]:e;if(!t.length){const e=y().filter((e=>!(e.status===ItemStatus.IDLE&&e.origin===FileOrigin.LOCAL)&&e.status!==ItemStatus.PROCESSING&&e.status!==ItemStatus.PROCESSING_COMPLETE&&e.status!==ItemStatus.PROCESSING_REVERT_ERROR));return Promise.all(e.map(O))}return Promise.all(t.map(O))},removeFiles:(...e)=>{const t=Array.isArray(e[0])?e[0]:e;let r;"object"==typeof t[t.length-1]?r=t.pop():Array.isArray(e[0])&&(r=e[1]);const o=y();if(!t.length)return Promise.all(o.map((e=>R(e,r))));return t.map((e=>isNumber(e)?o[e]?o[e].id:null:e)).filter((e=>e)).map((e=>R(e,r)))},prepareFiles:(...e)=>{const t=Array.isArray(e[0])?e[0]:e,r=t.length?t:y();return Promise.all(r.map(_))},sort:e=>o.dispatch("SORT",{compare:e}),browse:()=>{var e=p.element.querySelector("input[type=file]");e&&e.click()},destroy:()=>{S.fire("destroy",p.element),o.dispatch("ABORT_ALL"),p._destroy(),window.removeEventListener("resize",d),document.removeEventListener("visibilitychange",i),o.dispatch("DID_DESTROY")},insertBefore:e=>insertBefore(p.element,e),insertAfter:e=>insertAfter(p.element,e),appendTo:e=>e.appendChild(p.element),replaceElement:e=>{insertBefore(p.element,e),e.parentNode.removeChild(e),t=e},restoreElement:()=>{t&&(insertAfter(t,p.element),p.element.parentNode.removeChild(p.element),t=null)},isAttachedTo:e=>p.element===e||t===e,element:{get:()=>p.element},status:{get:()=>o.query("GET_STATUS")}};return o.dispatch("DID_INIT"),createObject(S)},createAppObject=(e={})=>{const t={};forin(getOptions(),((e,r)=>{t[e]=r[0]}));return createApp({...t,...e})},lowerCaseFirstLetter=e=>e.charAt(0).toLowerCase()+e.slice(1),attributeNameToPropertyName=e=>toCamels(e.replace(/^data-/,"")),mapObject=(e,t)=>{forin(t,((t,r)=>{forin(e,((o,i)=>{const n=new RegExp(t);if(!n.test(o))return;if(delete e[o],!1===r)return;if(isString(r))return void(e[r]=i);const s=r.group;var a;isObject(r)&&!e[s]&&(e[s]={}),e[s][(a=o.replace(n,""),a.charAt(0).toLowerCase()+a.slice(1))]=i})),r.mapping&&mapObject(e[r.group],r.mapping)}))},getAttributesAsObject=(e,t={})=>{const r=[];forin(e.attributes,(t=>{r.push(e.attributes[t])}));const o=r.filter((e=>e.name)).reduce(((t,r)=>{const o=attr(e,r.name);var i;return t[(i=r.name,toCamels(i.replace(/^data-/,"")))]=o===r.name||o,t}),{});return mapObject(o,t),o},createAppAtElement=(e,t={})=>{const r={"^class$":"className","^multiple$":"allowMultiple","^capture$":"captureMethod","^webkitdirectory$":"allowDirectoriesOnly","^server":{group:"server",mapping:{"^process":{group:"process"},"^revert":{group:"revert"},"^fetch":{group:"fetch"},"^restore":{group:"restore"},"^load":{group:"load"}}},"^type$":!1,"^files$":!1};applyFilters("SET_ATTRIBUTE_TO_OPTION_MAP",r);const o={...t},i=getAttributesAsObject("FIELDSET"===e.nodeName?e.querySelector("input[type=file]"):e,r);Object.keys(i).forEach((e=>{isObject(i[e])?(isObject(o[e])||(o[e]={}),Object.assign(o[e],i[e])):o[e]=i[e]})),o.files=(t.files||[]).concat(Array.from(e.querySelectorAll("input:not([type=file])")).map((e=>({source:e.value,options:{type:e.dataset.type}}))));const n=createAppObject(o);return e.files&&Array.from(e.files).forEach((e=>{n.addFile(e)})),n.replaceElement(e),n},createApp$1=(...e)=>e[0]instanceof HTMLElement?createAppAtElement(...e):createAppObject(...e),PRIVATE_METHODS=["fire","_read","_write"],createAppAPI=e=>{const t={};return copyObjectPropertiesToObject(e,t,PRIVATE_METHODS),t},replaceInString=(e,t)=>e.replace(/(?:{([a-zA-Z]+)})/g,((e,r)=>t[r])),createWorker=e=>{const t=new Blob(["(",e.toString(),")()"],{type:"application/javascript"}),r=URL.createObjectURL(t),o=new Worker(r);return{transfer:(e,t)=>{},post:(e,t,r)=>{const i=getUniqueId();o.onmessage=e=>{e.data.id===i&&t(e.data.message)},o.postMessage({id:i,message:e},r)},terminate:()=>{o.terminate(),URL.revokeObjectURL(r)}}},loadImage=e=>new Promise(((t,r)=>{const o=new Image;o.onload=()=>{t(o)},o.onerror=e=>{r(e)},o.src=e})),renameFile=(e,t)=>{const r=e.slice(0,e.size,e.type);return r.lastModifiedDate=e.lastModifiedDate,r.name=t,r},copyFile=e=>renameFile(e,e.name),registeredPlugins=[],createAppPlugin=e=>{if(registeredPlugins.includes(e))return;registeredPlugins.push(e);const t=e({addFilter:addFilter,utils:{Type:Type,forin:forin,isString:isString,isFile:isFile,toNaturalFileSize:toNaturalFileSize,replaceInString:replaceInString,getExtensionFromFilename:getExtensionFromFilename,getFilenameWithoutExtension:getFilenameWithoutExtension,guesstimateMimeType:guesstimateMimeType,getFileFromBlob:getFileFromBlob,getFilenameFromURL:getFilenameFromURL,createRoute:createRoute,createWorker:createWorker,createView:createView,createItemAPI:createItemAPI,loadImage:loadImage,copyFile:copyFile,renameFile:renameFile,createBlob:createBlob,applyFilterChain:applyFilterChain,text:text,getNumericAspectRatioFromString:getNumericAspectRatioFromString},views:{fileActionButton:fileActionButton}});var r;r=t.options,Object.assign(defaultOptions,r)},isOperaMini=()=>"[object OperaMini]"===Object.prototype.toString.call(window.operamini),hasPromises=()=>"Promise"in window,hasBlobSlice=()=>"slice"in Blob.prototype,hasCreateObjectURL=()=>"URL"in window&&"createObjectURL"in window.URL,hasVisibility=()=>"visibilityState"in document,hasTiming=()=>"performance"in window,hasCSSSupports=()=>"supports"in(window.CSS||{}),isIE11=()=>/MSIE|Trident/.test(window.navigator.userAgent),supported=(()=>{const e=isBrowser()&&!("[object OperaMini]"===Object.prototype.toString.call(window.operamini))&&"visibilityState"in document&&"Promise"in window&&"slice"in Blob.prototype&&"URL"in window&&"createObjectURL"in window.URL&&"performance"in window&&("supports"in(window.CSS||{})||/MSIE|Trident/.test(window.navigator.userAgent));return()=>e})(),state={apps:[]},name="filepond",fn=()=>{};let Status$1={},FileStatus={},FileOrigin$1={},OptionTypes={},create$f=fn,destroy=fn,parse=fn,find=fn,registerPlugin=fn,getOptions$1=fn,setOptions$1=fn;if(supported()){createPainter((()=>{state.apps.forEach((e=>e._read()))}),(e=>{state.apps.forEach((t=>t._write(e)))}));const e=()=>{document.dispatchEvent(new CustomEvent("FilePond:loaded",{detail:{supported:supported,create:create$f,destroy:destroy,parse:parse,find:find,registerPlugin:registerPlugin,setOptions:setOptions$1}})),document.removeEventListener("DOMContentLoaded",e)};"loading"!==document.readyState?setTimeout((()=>e()),0):document.addEventListener("DOMContentLoaded",e);const t=()=>forin(getOptions(),((e,t)=>{OptionTypes[e]=t[1]}));Status$1={...Status},FileOrigin$1={...FileOrigin},FileStatus={...ItemStatus},OptionTypes={},t(),create$f=(...e)=>{const t=createApp$1(...e);return t.on("destroy",destroy),state.apps.push(t),createAppAPI(t)},destroy=e=>{const t=state.apps.findIndex((t=>t.isAttachedTo(e)));if(t>=0){return state.apps.splice(t,1)[0].restoreElement(),!0}return!1},parse=e=>Array.from(e.querySelectorAll(`.${name}`)).filter((e=>!state.apps.find((t=>t.isAttachedTo(e))))).map((e=>create$f(e))),find=e=>{const t=state.apps.find((t=>t.isAttachedTo(e)));return t?createAppAPI(t):null},registerPlugin=(...e)=>{e.forEach(createAppPlugin),t()},getOptions$1=()=>{const e={};return forin(getOptions(),((t,r)=>{e[t]=r[0]})),e},setOptions$1=e=>(isObject(e)&&(state.apps.forEach((t=>{t.setOptions(e)})),setOptions(e)),getOptions$1())}export{FileOrigin$1 as FileOrigin,FileStatus,OptionTypes,Status$1 as Status,create$f as create,destroy,find,getOptions$1 as getOptions,parse,registerPlugin,setOptions$1 as setOptions,supported};
